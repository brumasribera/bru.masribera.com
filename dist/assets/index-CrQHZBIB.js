var A=(d,S,u)=>new Promise((v,h)=>{var b=o=>{try{c(u.next(o))}catch(f){h(f)}},g=o=>{try{c(u.throw(o))}catch(f){h(f)}},c=o=>o.done?v(o.value):Promise.resolve(o.value).then(b,g);c((u=u.apply(d,S)).next())});import{r,j as m}from"./index-CGVO4QuZ.js";const E={start:"/timer-sounds/start-gong.mp3",middle:"/timer-sounds/middle-gong.mp3",minute:"/timer-sounds/1m-gong.mp3",end:"/timer-sounds/end-gong.mp3"};function q(){const[d,S]=r.useState(480),[u,v]=r.useState(!1),[h,b]=r.useState(!1),g=r.useRef(null),c=r.useRef({}),o=r.useRef(!1),f=r.useRef({});r.useEffect(()=>{document.title="Stretch Timer",setTimeout(()=>{document.title="Stretch Timer"},100);const i=()=>{document.hidden||(document.title="Stretch Timer")};return document.addEventListener("visibilitychange",i),(()=>{document.querySelectorAll("link[rel='manifest']").forEach(l=>l.remove());const s=document.createElement("link");s.rel="manifest",s.href=`/tools/timer/manifest.webmanifest?v=${Date.now()}`,s.setAttribute("data-timer-manifest","true"),document.head.appendChild(s),console.log("Timer manifest set to:",s.href),console.log("Current path:",window.location.pathname)})(),(()=>{[{name:"mobile-web-app-capable",content:"yes"},{name:"apple-mobile-web-app-capable",content:"yes"},{name:"apple-mobile-web-app-status-bar-style",content:"black-translucent"},{name:"apple-mobile-web-app-title",content:"Stretch Timer"},{name:"application-name",content:"Stretch Timer"},{name:"msapplication-TileColor",content:"#000000"},{name:"msapplication-config",content:"/browserconfig.xml"},{name:"name",content:"Stretch Timer"},{name:"title",content:"Stretch Timer"}].forEach(s=>{if(!document.querySelector(`meta[name="${s.name}"]`)){const p=document.createElement("meta");p.name=s.name,p.content=s.content,document.head.appendChild(p)}})})(),(()=>{"serviceWorker"in navigator&&navigator.serviceWorker.register("/sw.js").then(n=>{console.log("Timer service worker registered:",n)}).catch(n=>{console.error("Timer service worker registration failed:",n)})})(),()=>{const n=document.querySelector("link[data-timer-manifest='true']");n&&n.remove();const s=document.createElement("link");s.rel="manifest",s.href="/site.webmanifest",document.head.appendChild(s),console.log("Restored original manifest:",s.href),["mobile-web-app-capable","apple-mobile-web-app-capable","apple-mobile-web-app-status-bar-style","apple-mobile-web-app-title","application-name","msapplication-TileColor","msapplication-config"].forEach(p=>{const y=document.querySelector(`meta[name="${p}"]`);y&&y.remove()}),document.title="Bru Mas Ribera - Frontend & UX Engineer",document.removeEventListener("visibilitychange",i),"serviceWorker"in navigator&&navigator.serviceWorker.getRegistrations().then(p=>{p.forEach(y=>{y.scope.includes("/tools/timer")&&(y.unregister(),console.log("Timer service worker unregistered"))})})}},[]),r.useEffect(()=>{(()=>{const t=document.querySelector("link[rel*='icon']");if(t)t.dataset.originalHref||(t.dataset.originalHref=t.href),t.href="/favicons/favicon-timer.svg";else{const n=document.createElement("link");n.type="image/svg+xml",n.rel="icon",n.href="/favicons/favicon-timer.svg",document.head.appendChild(n)}})();let e=!0;return A(this,null,function*(){for(const[t,n]of Object.entries(E)){if(!e)break;try{if(!(yield fetch(n)).ok)continue;if(!e)break;const l=M(n);l.addEventListener("error",()=>{}),l.addEventListener("canplaythrough",()=>{}),l.addEventListener("pause",()=>{}),l.addEventListener("play",()=>{}),l.addEventListener("ended",()=>{C()}),c.current[t]=l}catch(s){}}}),()=>{e=!1;const t=document.querySelector("link[rel*='icon']");t&&t.dataset.originalHref?(t.href=t.dataset.originalHref,delete t.dataset.originalHref):t&&t.href.includes("favicon-timer")&&(t.href="/favicon.ico"),Object.values(c.current).forEach(n=>{n.pause(),n.src=""}),c.current={}}},[]);const x=r.useCallback(()=>{const i=document.querySelectorAll("audio");let e=!1;return f.current={},i.forEach((t,n)=>{!t.hasAttribute("data-timer-audio")&&!t.paused&&(e=!0,f.current[`audio_${n}`]={element:t,wasPlaying:!0,currentTime:t.currentTime,volume:t.volume})}),document.querySelectorAll("video").forEach((t,n)=>{!t.paused&&t.volume>0&&(e=!0,f.current[`video_${n}`]={element:t,wasPlaying:!0,currentTime:t.currentTime,volume:t.volume})}),e},[]),C=r.useCallback(()=>{o.current&&setTimeout(()=>{Object.values(f.current).forEach(e=>{if(e.wasPlaying&&e.element)try{if(e.element.tagName==="AUDIO"||e.element.tagName==="VIDEO"){e.element.currentTime=e.currentTime,e.element.volume=e.volume;const a=e.element.play();a!==void 0&&a.catch(()=>{})}}catch(a){}});const i=new Event("resume-audio",{bubbles:!0});document.dispatchEvent(i),"mediaSession"in navigator&&(navigator.mediaSession.playbackState="none",navigator.mediaSession.metadata=null),window.dispatchEvent(new Event("focus")),document.dispatchEvent(new Event("visibilitychange")),o.current=!1,f.current={}},100)},[]);r.useCallback(()=>{"mediaSession"in navigator&&(navigator.mediaSession.metadata=new MediaMetadata({title:"Timer Gong",artist:"Stretch Timer",album:"Meditation Sounds"}),navigator.mediaSession.playbackState="none",navigator.mediaSession.setActionHandler("play",()=>{}),navigator.mediaSession.setActionHandler("pause",()=>{}),navigator.mediaSession.setActionHandler("stop",()=>{}),navigator.mediaSession.setActionHandler("seekbackward",()=>{}),navigator.mediaSession.setActionHandler("seekforward",()=>{}),navigator.mediaSession.setActionHandler("seekto",()=>{}),navigator.mediaSession.setActionHandler("previoustrack",()=>{}),navigator.mediaSession.setActionHandler("nexttrack",()=>{}))},[]);const j=r.useCallback(()=>{if("mediaSession"in navigator&&(navigator.mediaSession.metadata=new MediaMetadata({title:"Timer Gong",artist:"Stretch Timer",album:"Meditation Sounds"}),navigator.mediaSession.playbackState="none",navigator.mediaSession.setActionHandler("play",()=>{}),navigator.mediaSession.setActionHandler("pause",()=>{}),navigator.mediaSession.setActionHandler("stop",()=>{}),navigator.mediaSession.setActionHandler("seekbackward",()=>{}),navigator.mediaSession.setActionHandler("seekforward",()=>{}),navigator.mediaSession.setActionHandler("seekto",()=>{}),navigator.mediaSession.setActionHandler("previoustrack",()=>{}),navigator.mediaSession.setActionHandler("nexttrack",()=>{}),"setAudioFocusRequest"in navigator.mediaSession))try{navigator.mediaSession.setAudioFocusRequest({audioFocusRequestType:"transient_may_duck"})}catch(i){}},[]),M=r.useCallback(i=>{const e=new Audio(i);return e.preload="auto",e.volume=.5,e.loop=!1,e.setAttribute("data-timer-audio","true"),e.setAttribute("data-notification-style","true"),e.addEventListener("loadedmetadata",()=>{e.duration>3&&e.addEventListener("timeupdate",()=>{e.currentTime>=3&&(e.pause(),e.currentTime=0)})}),e},[]),H=r.useCallback(i=>{try{const e=new(window.AudioContext||window.webkitAudioContext);fetch(i).then(a=>a.arrayBuffer()).then(a=>e.decodeAudioData(a)).then(a=>{const t=e.createBufferSource();t.buffer=a;const n=e.createGain();n.gain.setValueAtTime(.4,e.currentTime),t.connect(n),n.connect(e.destination),e.state==="suspended"&&e.resume(),t.start(0),t.stop(e.currentTime+Math.min(a.duration,2)),setTimeout(()=>{e.close()},3e3)}).catch(()=>{e.close()})}catch(e){}},[]),w=r.useCallback(()=>{!c.current||Object.keys(c.current).length===0||Object.entries(c.current).forEach(([i,e])=>{e.paused&&e.currentTime>0&&e.currentTime<e.duration&&e.play().catch(()=>{})})},[]);r.useEffect(()=>{const i=()=>{w()},e=()=>{document.hidden||w()};return window.addEventListener("focus",i),document.addEventListener("visibilitychange",e),()=>{window.removeEventListener("focus",i),document.removeEventListener("visibilitychange",e)}},[w]);const k=i=>{const e=E[i];try{o.current||(o.current=x()),H(e);const a=c.current[i];if(a){j(),a.currentTime=0,a.volume=.4;const t=a.play();t!==void 0&&t.then(()=>{"mediaSession"in navigator&&(navigator.mediaSession.playbackState="none",setTimeout(()=>{"mediaSession"in navigator&&(navigator.mediaSession.metadata=null)},100))}).catch(n=>{})}}catch(a){}};r.useEffect(()=>(u&&d>0?g.current=setInterval(()=>{S(i=>{const e=i-1;return e>0&&e%60===0&&k("minute"),e===4*60&&k("middle"),e})},1e3):d===0&&!h&&(b(!0),v(!1),k("end")),()=>{g.current&&clearInterval(g.current)}),[u,d,h]);const R=()=>{d!==0&&(v(!0),b(!1),d===8*60&&k("start"))},T=()=>{v(!1),g.current&&clearInterval(g.current)},L=()=>{T(),S(8*60),b(!1),v(!1)},N=i=>{const e=Math.floor(i/60),a=i%60;return`${e.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`};return m.jsx("div",{className:"min-h-screen bg-black flex items-center justify-center p-4",children:m.jsxs("div",{className:"text-center",children:[m.jsx("div",{className:"text-8xl font-light text-gray-300 mb-8 font-mono tracking-wider",children:N(d)}),m.jsxs("div",{className:"flex gap-6 justify-center",children:[!u&&d>0&&!h&&m.jsx("button",{onClick:R,className:"w-16 h-16 bg-gray-700 text-gray-200 rounded-full font-medium hover:bg-gray-600 transition-all duration-200 flex items-center justify-center",title:"Start",children:m.jsx("div",{className:"w-0 h-0 border-l-[16px] border-l-gray-200 border-t-[10px] border-t-transparent border-b-[10px] border-b-transparent ml-1"})}),u&&m.jsxs("button",{onClick:T,className:"w-16 h-16 bg-gray-700 text-gray-200 rounded-full font-medium hover:bg-gray-600 transition-all duration-200 flex items-center justify-center gap-1",title:"Pause",children:[m.jsx("div",{className:"w-1.5 h-6 bg-gray-200 rounded-sm"}),m.jsx("div",{className:"w-1.5 h-6 bg-gray-200 rounded-sm"})]}),m.jsx("button",{onClick:L,className:"w-16 h-16 bg-gray-800 text-gray-200 rounded-full font-medium hover:bg-gray-700 transition-all duration-200 flex items-center justify-center text-3xl",title:"Reset",children:"â†º"})]})]})})}export{q as TimerPage};
