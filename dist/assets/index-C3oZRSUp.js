var p=(t,i,o)=>new Promise((c,s)=>{var u=e=>{try{a(o.next(e))}catch(l){s(l)}},n=e=>{try{a(o.throw(e))}catch(l){s(l)}},a=e=>e.done?c(e.value):Promise.resolve(e.value).then(u,n);a((o=o.apply(t,i)).next())});import{r,j as f}from"./index-Gyg2tvMo.js";const j={start:"/timer-sounds/start-gong.mp3",middle:"/timer-sounds/middle-gong.mp3",minute:"/timer-sounds/1m-gong.mp3",end:"/timer-sounds/end-gong.mp3"};function E(){const t=r.useRef(),i=r.useRef(),o=r.useRef({}),c=r.useRef(!1),s=()=>p(this,null,function*(){if(!c.current)try{t.current=new(window.AudioContext||window.webkitAudioContext),i.current=t.current.createGain(),i.current.gain.value=.3,i.current.connect(t.current.destination),console.log("ðŸŽµ Loading audio files...");for(const[n,a]of Object.entries(j))try{console.log(`ðŸŽµ Loading ${n}: ${a}`);const e=yield fetch(a);if(!e.ok){console.warn(`âŒ Failed to fetch ${n}: ${e.status}`);continue}const l=yield e.arrayBuffer();o.current[n]=yield t.current.decodeAudioData(l),console.log(`âœ… Loaded ${n} audio`)}catch(e){console.error(`âŒ Error loading ${n}:`,e)}console.log("ðŸŽµ Audio system ready:",Object.keys(o.current)),c.current=!0}catch(n){console.error("âŒ Failed to initialize audio system:",n)}}),u=r.useCallback(n=>p(this,null,function*(){if(console.log(`ðŸ”” Attempting to play ${n} gong`),c.current||(yield s()),!t.current||!i.current){console.warn("âŒ Audio system not initialized");return}if(!o.current[n]){console.warn(`âŒ Audio buffer not loaded for ${n}`);return}t.current.state==="suspended"&&(console.log("ðŸŽµ Resuming suspended audio context"),yield t.current.resume());try{const a=t.current.createBufferSource();a.buffer=o.current[n],a.connect(i.current),a.onended=()=>{console.log(`âœ… ${n} gong finished playing`)},a.start(0),console.log(`âœ… Playing ${n} gong (duration: ${o.current[n].duration.toFixed(2)}s)`),console.log(`ðŸ“Š ${n} gong buffer duration: ${o.current[n].duration.toFixed(2)}s`)}catch(a){console.error(`âŒ Error playing ${n} gong:`,a)}}),[]);return r.useEffect(()=>()=>{t.current&&t.current.close()},[]),u}function M(){r.useEffect(()=>{document.title="Stretch Timer";const t=document.querySelector("link[rel*='icon']"),i=t==null?void 0:t.href;t&&(t.href="/favicons/favicon-timer.svg");const o=document.querySelector("link[rel='manifest']");o==null||o.remove();const c=document.createElement("link");c.rel="manifest",c.href=`/tools/timer/manifest.webmanifest?v=${Date.now()}`,document.head.appendChild(c);const s=(e,l)=>{const y=document.querySelector(`meta[name="${e}"]`);y&&y.remove();const m=document.createElement("meta");return m.name=e,m.content=l,document.head.appendChild(m),m},u=s("theme-color","#000000"),n=s("apple-mobile-web-app-capable","yes"),a=s("mobile-web-app-capable","yes");return"serviceWorker"in navigator&&navigator.serviceWorker.register("/sw.js").then(e=>console.log("âœ” Service Worker registered",e)).catch(e=>console.error("âŒ Service Worker error",e)),()=>{document.title="Bru Mas Ribera - Frontend & UX Engineer",t&&i&&(t.href=i),c.remove(),u.remove(),n.remove(),a.remove();const e=document.createElement("link");e.rel="manifest",e.href="/site.webmanifest",document.head.appendChild(e)}},[])}function D({active:t,startTime:i}){const[o,c]=r.useState([]),s=r.useRef(0),u=r.useRef(),[n,a]=r.useState(!1);return r.useEffect(()=>{if(!t||n){c([]),clearInterval(u.current);return}if(i&&Date.now()-i>=5*60*1e3){a(!0);return}return u.current=setInterval(()=>{const e={id:s.current++,left:`${Math.random()*100}%`,size:Math.random()*2+1,delay:0,duration:Math.random()*5+3,rotate:Math.random()*20-10};console.log("ðŸŒŸ Generated star:",e),c(l=>[...l.slice(-300),e])},75),()=>clearInterval(u.current)},[t]),console.log("ðŸŒŸ ShootingStars render - active:",t,"stars count:",o.length),f.jsxs("div",{className:"fixed inset-0 pointer-events-none z-10",children:[o.map(e=>f.jsx("div",{className:"absolute bg-white opacity-90 rounded-full",style:{top:"0px",left:e.left,width:`${e.size*2}px`,height:`${e.size*2}px`,animationDuration:`${e.duration}s`,animationName:"fall",animationFillMode:"forwards",animationTimingFunction:"linear"}},e.id)),f.jsx("style",{children:`
        @keyframes fall {
          0% { transform: translateY(-50px); opacity: 1; }
          100% { transform: translateY(100vh); opacity: 0; }
        }
      `})]})}const R=[420,360,300,240,180,120,60];function A(){const[t,i]=r.useState(480),[o,c]=r.useState(!1),[s,u]=r.useState(!1),[n,a]=r.useState(!1),[e,l]=r.useState(!1),[y,m]=r.useState(null),g=r.useRef(0),x=r.useRef(),w=r.useRef({}),b=E();M(),r.useEffect(()=>{g.current&&s&&Math.max(0,Math.ceil((g.current-Date.now())/1e3))===0&&l(!0)},[s]),r.useEffect(()=>{if(o)return x.current=setInterval(()=>{const d=Math.max(0,Math.ceil((g.current-Date.now())/1e3));if(i(d),d===0){v("end"),l(!0),m(Date.now());return}if(R.includes(d)){const h=`gong_${d}`;w.current[h]||(w.current[h]=Date.now(),a(!0),b(d===240?"middle":"minute").catch(console.error),setTimeout(()=>a(!1),5e3))}},250),()=>clearInterval(x.current)},[o,b]),r.useEffect(()=>{const d=()=>{if(!document.hidden&&g.current){const h=Math.max(0,Math.ceil((g.current-Date.now())/1e3));i(h),h===0&&(s?l(!0):v("end"))}};return document.addEventListener("visibilitychange",d),()=>document.removeEventListener("visibilitychange",d)},[o,s]);const S=()=>p(this,null,function*(){s||t===0||(g.current=Date.now()+t*1e3,c(!0),u(!1),w.current={},l(!1),m(null),b("start"))}),v=d=>p(this,null,function*(){c(!1),d&&(yield b(d),d==="end"&&(u(!0),l(!0),m(Date.now()))),d!=="end"&&l(!1)}),k=()=>{v(),i(480),u(!1),w.current={},l(!1),m(null)},$=d=>`${String(Math.floor(d/60)).padStart(2,"0")}:${String(d%60).padStart(2,"0")}`;return f.jsxs(f.Fragment,{children:[f.jsx("style",{children:`
          @keyframes timer-pulse-slow {
            0% { background-position: 0% 0%; }
            25% { background-position: 100% 0%; }
            50% { background-position: 100% 100%; }
            75% { background-position: 0% 100%; }
            100% { background-position: 0% 0%; }
          }
          @keyframes timer-pulse-fast {
            0% { background-position: 0% 0%; }
            25% { background-position: 100% 0%; }
            50% { background-position: 100% 100%; }
            75% { background-position: 0% 100%; }
            100% { background-position: 0% 0%; }
          }

          

        `}),f.jsxs("div",{className:`min-h-screen text-white font-mono flex flex-col items-center justify-center overflow-hidden relative ${n?"gong-playing":""}`,"data-timer-page":"true",style:{background:"linear-gradient(135deg, #000000 0%, #0a0a0a 20%, #0a0f1c 40%, #0a0a0a 60%, #0a0f1c 80%, #000000 100%)",backgroundSize:"150% 150%",animation:n?"timer-pulse-fast 8s ease-in-out infinite":"timer-pulse-slow 40s ease-in-out infinite"},children:[e&&f.jsx(D,{active:!0,startTime:y}),f.jsx("div",{className:"text-8xl mb-6 text-gray-300 tracking-wider font-light",children:$(t)}),f.jsxs("div",{className:"flex gap-6",children:[!o&&t>0&&!s&&f.jsx("button",{onClick:S,title:"Start",className:"w-16 h-16 bg-gray-700 hover:bg-gray-600 rounded-full flex items-center justify-center",children:f.jsx("svg",{className:"w-10 h-10 text-gray-200",viewBox:"0 0 24 24",fill:"currentColor",children:f.jsx("path",{d:"M8 5.5c0-0.3 0.2-0.5 0.5-0.5l11 6.5c0.3 0.2 0.3 0.6 0 0.8l-11 6.5c-0.3 0.2-0.5 0-0.5-0.3V5.5z"})})}),o&&f.jsxs("button",{onClick:()=>v(),title:"Pause",className:"w-16 h-16 bg-gray-700 hover:bg-gray-600 rounded-full flex items-center justify-center gap-1",children:[f.jsx("div",{className:"w-1.5 h-6 bg-gray-200 rounded-sm"}),f.jsx("div",{className:"w-1.5 h-6 bg-gray-200 rounded-sm"})]}),f.jsx("button",{onClick:k,title:"Reset",className:"w-16 h-16 bg-gray-800 hover:bg-gray-700 rounded-full flex items-center justify-center text-4xl",children:"â†º"})]})]})]})}function T(){const[t,i]=r.useState("v1.1.9"),[o,c]=r.useState("28 Thursday August 16:59");return r.useEffect(()=>{fetch(`/VERSION.json?v=${Date.now()}`).then(s=>s.json()).then(s=>{const u=new Date(s.timestamp+" UTC");i(`v${s.version}`),c(`${u.getDate()} ${u.toLocaleDateString("en-US",{weekday:"long"})} ${u.toLocaleDateString("en-US",{month:"long"})} ${u.toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit"})}`)}).catch(()=>{})},[]),{version:t,date:o}}export{A as TimerPage,E as useAudio,M as usePWA,T as useVersion};
