import{r,j as a}from"./index-8Ax7gpB4.js";const D={minute:"/timer-sounds/1m-gong.mp3",middle:"/timer-sounds/middle-gong.mp3",end:"/timer-sounds/end-gong.mp3"},y=[{bg:"bg-blue-600",border:"border-blue-400",text:"text-white"},{bg:"bg-green-600",border:"border-green-400",text:"text-white"},{bg:"bg-purple-600",border:"border-purple-400",text:"text-white"},{bg:"bg-orange-600",border:"border-orange-400",text:"text-white"},{bg:"bg-pink-600",border:"border-pink-400",text:"text-white"},{bg:"bg-indigo-600",border:"border-indigo-400",text:"text-white"},{bg:"bg-teal-600",border:"border-teal-400",text:"text-white"},{bg:"bg-red-600",border:"border-red-400",text:"text-white"},{bg:"bg-yellow-600",border:"border-yellow-400",text:"text-black"},{bg:"bg-cyan-600",border:"border-cyan-400",text:"text-white"},{bg:"bg-emerald-600",border:"border-emerald-400",text:"text-white"},{bg:"bg-rose-600",border:"border-rose-400",text:"text-white"},{bg:"bg-violet-600",border:"border-violet-400",text:"text-white"},{bg:"bg-amber-600",border:"border-amber-400",text:"text-black"},{bg:"bg-lime-600",border:"border-lime-400",text:"text-black"},{bg:"bg-sky-600",border:"border-sky-400",text:"text-white"}];function P(){const[c,w]=r.useState(480),[m,x]=r.useState(!1),[A,h]=r.useState(!1),[b,R]=r.useState("v1.1.3"),[N,E]=r.useState("2025-08-27 11:45:00"),i=r.useRef(null),o=r.useRef(null),s=r.useRef(null),p=r.useRef(!1),u=r.useRef({}),v=r.useCallback(t=>{const e=t.match(/v?(\d+)\.(\d+)\.(\d+)/);if(!e)return y[0];const l=parseInt(e[1]),n=parseInt(e[2]),d=parseInt(e[3]),$=(l*1e4+n*100+d)%y.length;return y[$]},[]),S=r.useCallback(()=>{const t=document.querySelectorAll("audio");let e=!1;return u.current={},t.forEach((n,d)=>{!n.hasAttribute("data-timer-audio")&&!n.paused&&(e=!0,u.current[`audio_${d}`]={element:n,wasPlaying:!0,currentTime:n.currentTime,volume:n.volume})}),document.querySelectorAll("video").forEach((n,d)=>{!n.paused&&n.volume>0&&(e=!0,u.current[`video_${d}`]={element:n,wasPlaying:!0,currentTime:n.currentTime,volume:n.volume})}),e},[]),g=r.useCallback(()=>{p.current&&setTimeout(()=>{Object.values(u.current).forEach(t=>{if(t.wasPlaying&&t.element)try{if(t.element.tagName==="AUDIO"||t.element.tagName==="VIDEO"){t.element.currentTime=t.currentTime,t.element.volume=t.volume;const e=t.element.play();e!==void 0&&e.catch(()=>{})}}catch(e){}}),"mediaSession"in navigator&&(navigator.mediaSession.playbackState="none",navigator.mediaSession.metadata=null),p.current=!1,u.current={}},100)},[]),k=r.useCallback(t=>{const e=new Audio(t);return e.preload="auto",e.volume=.5,e.loop=!1,e.setAttribute("data-timer-audio","true"),e.setAttribute("data-notification-style","true"),e.addEventListener("loadedmetadata",()=>{e.duration>3&&e.addEventListener("timeupdate",()=>{e.currentTime>=3&&(e.pause(),e.currentTime=0)})}),e},[]),T=r.useCallback(()=>{"mediaSession"in navigator&&(navigator.mediaSession.metadata=new MediaMetadata({title:"Timer Gong",artist:"Stretch Timer",album:"Meditation Sounds"}),navigator.mediaSession.playbackState="none",navigator.mediaSession.setActionHandler("play",()=>{}),navigator.mediaSession.setActionHandler("pause",()=>{}),navigator.mediaSession.setActionHandler("stop",()=>{}),navigator.mediaSession.setActionHandler("seekbackward",()=>{}),navigator.mediaSession.setActionHandler("seekforward",()=>{}),navigator.mediaSession.setActionHandler("seekto",()=>{}),navigator.mediaSession.setActionHandler("previoustrack",()=>{}),navigator.mediaSession.setActionHandler("nexttrack",()=>{}))},[]),f=r.useCallback(t=>{p.current=S(),T();const e=k(D[t]);e.play().then(()=>{e.addEventListener("ended",()=>{g(),e.src=""},{once:!0}),setTimeout(()=>{e.ended||(e.pause(),e.currentTime=0,g(),e.src="")},3e3)}).catch(l=>{console.warn(`Could not play gong ${t}:`,l),g()})},[S,T,k,g]);r.useEffect(()=>{fetch(`/VERSION.json?v=${Date.now()}`).then(t=>t.json()).then(t=>{R(`v${t.version}`),E(t.timestamp)}).catch(t=>{console.warn("Failed to load version info:",t)})},[]),r.useEffect(()=>{if(m&&c>0)return i.current||(i.current=Date.now()),o.current=setInterval(()=>{const t=Math.floor((Date.now()-i.current)/1e3),e=Math.max(0,8*60-t);w(e),e>0&&e%60===0&&s.current!==e&&(f("minute"),s.current=e),e===4*60&&s.current!==e&&(f("middle"),s.current=e),e===0&&s.current!==e&&(f("end"),s.current=e,h(!0),x(!1),i.current=null)},100),()=>{o.current&&clearInterval(o.current)};o.current&&(clearInterval(o.current),o.current=null)},[m,c,f]),r.useEffect(()=>(document.title="Stretch Timer",()=>{document.title="Bru Mas Ribera - Frontend & UX Engineer"}),[]);const C=()=>{c!==0&&(x(!0),h(!1),i.current=Date.now(),s.current=null)},j=()=>{x(!1),o.current&&(clearInterval(o.current),o.current=null)},I=()=>{j(),w(8*60),h(!1),i.current=null,s.current=null},O=t=>{const e=Math.floor(t/60),l=t%60;return`${e.toString().padStart(2,"0")}:${l.toString().padStart(2,"0")}`};return a.jsx("div",{className:"min-h-screen bg-black flex items-center justify-center p-4",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"text-8xl font-light text-gray-300 mb-8 font-mono tracking-wider",children:O(c)}),a.jsxs("div",{className:"flex gap-6 justify-center",children:[!m&&c>0&&!A&&a.jsx("button",{onClick:C,className:"w-16 h-16 bg-gray-700 text-gray-200 rounded-full font-medium hover:bg-gray-600 transition-all duration-200 flex items-center justify-center",title:"Start",children:a.jsx("div",{className:"w-0 h-0 border-l-[16px] border-l-gray-200 border-t-[10px] border-t-transparent border-b-[10px] border-b-transparent ml-1"})}),m&&a.jsxs("button",{onClick:j,className:"w-16 h-16 bg-gray-700 text-gray-200 rounded-full font-medium hover:bg-gray-600 transition-all duration-200 flex items-center justify-center gap-1",title:"Pause",children:[a.jsx("div",{className:"w-1.5 h-6 bg-gray-200 rounded-sm"}),a.jsx("div",{className:"w-1.5 h-6 bg-gray-200 rounded-sm"})]}),a.jsx("button",{onClick:I,className:"w-16 h-16 bg-gray-800 text-gray-200 rounded-full font-medium hover:bg-gray-700 transition-all duration-200 flex items-center justify-center text-3xl",title:"Reset",children:"â†º"})]}),a.jsx("div",{className:"mt-6 text-center",children:a.jsxs("span",{className:`inline-block ${v(b).bg} ${v(b).text} text-sm px-4 py-2 rounded-lg font-mono border-2 ${v(b).border} shadow-lg`,children:["ðŸš€ ",b," â€¢ ",N]})})]})})}export{P as TimerPage};
