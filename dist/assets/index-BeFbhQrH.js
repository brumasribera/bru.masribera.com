var x=(l,v,m)=>new Promise((g,p)=>{var b=s=>{try{a(m.next(s))}catch(d){p(d)}},f=s=>{try{a(m.throw(s))}catch(d){p(d)}},a=s=>s.done?g(s.value):Promise.resolve(s.value).then(b,f);a((m=m.apply(l,v)).next())});import{r as o,j as c}from"./index-DxZogIwB.js";const j={start:"/timer-sounds/start-gong.mp3",middle:"/timer-sounds/middle-gong.mp3",minute:"/timer-sounds/1m-gong.mp3",end:"/timer-sounds/end-gong.mp3"};function M(){const[l,v]=o.useState(480),[m,g]=o.useState(!1),[p,b]=o.useState(!1),f=o.useRef(null),a=o.useRef({});o.useEffect(()=>(document.title="Stretch Timer",(()=>{const e=document.querySelector("link[rel='manifest']");e&&(e.dataset.originalHref||(e.dataset.originalHref=e.href),e.href="/tools/timer/manifest.webmanifest",console.log("Timer manifest set to:",e.href),console.log("Current path:",window.location.pathname))})(),(()=>{[{name:"mobile-web-app-capable",content:"yes"},{name:"apple-mobile-web-app-capable",content:"yes"},{name:"apple-mobile-web-app-status-bar-style",content:"black-translucent"},{name:"apple-mobile-web-app-title",content:"Stretch Timer"},{name:"application-name",content:"Stretch Timer"},{name:"msapplication-TileColor",content:"#000000"},{name:"msapplication-config",content:"/browserconfig.xml"}].forEach(n=>{if(!document.querySelector(`meta[name="${n.name}"]`)){const r=document.createElement("meta");r.name=n.name,r.content=n.content,document.head.appendChild(r)}})})(),(()=>{"serviceWorker"in navigator&&navigator.serviceWorker.register("/sw.js").then(e=>{console.log("Timer service worker registered:",e)}).catch(e=>{console.error("Timer service worker registration failed:",e)})})(),()=>{const e=document.querySelector("link[rel='manifest']");e&&e.dataset.originalHref&&(e.href=e.dataset.originalHref,delete e.dataset.originalHref,console.log("Restored original manifest:",e.href)),["mobile-web-app-capable","apple-mobile-web-app-capable","apple-mobile-web-app-status-bar-style","apple-mobile-web-app-title","application-name","msapplication-TileColor","msapplication-config"].forEach(h=>{const r=document.querySelector(`meta[name="${h}"]`);r&&r.remove()}),document.title="Bru Mas Ribera - Frontend & UX Engineer","serviceWorker"in navigator&&navigator.serviceWorker.getRegistrations().then(h=>{h.forEach(r=>{r.scope.includes("/tools/timer")&&(r.unregister(),console.log("Timer service worker unregistered"))})})}),[]),o.useEffect(()=>{(()=>{const e=document.querySelector("link[rel*='icon']");if(e)e.dataset.originalHref||(e.dataset.originalHref=e.href),e.href="/favicons/favicon-timer.svg";else{const n=document.createElement("link");n.type="image/svg+xml",n.rel="icon",n.href="/favicons/favicon-timer.svg",document.head.appendChild(n)}})();let t=!0;return x(this,null,function*(){for(const[e,n]of Object.entries(j)){if(!t)break;try{if(!(yield fetch(n)).ok)continue;if(!t)break;const r=new Audio(n);r.preload="auto",r.volume=1,a.current[e]=r,r.addEventListener("error",()=>{}),r.addEventListener("canplaythrough",()=>{}),r.addEventListener("pause",()=>{}),r.addEventListener("play",()=>{})}catch(h){}}}),()=>{t=!1;const e=document.querySelector("link[rel*='icon']");e&&e.dataset.originalHref?(e.href=e.dataset.originalHref,delete e.dataset.originalHref):e&&e.href.includes("favicon-timer")&&(e.href="/favicon.ico"),Object.values(a.current).forEach(n=>{n.pause(),n.src=""}),a.current={}}},[]);const s=o.useCallback(()=>{!a.current||Object.keys(a.current).length===0||Object.entries(a.current).forEach(([i,t])=>{t.paused&&t.currentTime>0&&t.currentTime<t.duration&&t.play().catch(()=>{})})},[]);o.useEffect(()=>{const i=()=>{s()},t=()=>{document.hidden||s()};return window.addEventListener("focus",i),document.addEventListener("visibilitychange",t),()=>{window.removeEventListener("focus",i),document.removeEventListener("visibilitychange",t)}},[s]);const d=i=>{const t=a.current[i];if(t)try{t.currentTime=0,t.volume=1;const u=t.play();u!==void 0&&u.catch(e=>{})}catch(u){}};o.useEffect(()=>(m&&l>0?f.current=setInterval(()=>{v(i=>{const t=i-1;return t>0&&t%60===0&&d("minute"),t===4*60&&d("middle"),t})},1e3):l===0&&!p&&(b(!0),g(!1),d("end")),()=>{f.current&&clearInterval(f.current)}),[m,l,p]);const w=()=>{l!==0&&(g(!0),b(!1),l===8*60&&d("start"))},y=()=>{g(!1),f.current&&clearInterval(f.current)},k=()=>{y(),v(8*60),b(!1),g(!1)},T=i=>{const t=Math.floor(i/60),u=i%60;return`${t.toString().padStart(2,"0")}:${u.toString().padStart(2,"0")}`};return c.jsx("div",{className:"min-h-screen bg-black flex items-center justify-center p-4",children:c.jsxs("div",{className:"text-center",children:[c.jsx("div",{className:"text-8xl font-light text-gray-300 mb-8 font-mono tracking-wider",children:T(l)}),c.jsxs("div",{className:"flex gap-6 justify-center",children:[!m&&l>0&&!p&&c.jsx("button",{onClick:w,className:"w-16 h-16 bg-gray-700 text-gray-200 rounded-full font-medium hover:bg-gray-600 transition-all duration-200 flex items-center justify-center",title:"Start",children:c.jsx("div",{className:"w-0 h-0 border-l-[16px] border-l-gray-200 border-t-[10px] border-t-transparent border-b-[10px] border-b-transparent ml-1"})}),m&&c.jsxs("button",{onClick:y,className:"w-16 h-16 bg-gray-700 text-gray-200 rounded-full font-medium hover:bg-gray-600 transition-all duration-200 flex items-center justify-center gap-1",title:"Pause",children:[c.jsx("div",{className:"w-1.5 h-6 bg-gray-200 rounded-sm"}),c.jsx("div",{className:"w-1.5 h-6 bg-gray-200 rounded-sm"})]}),c.jsx("button",{onClick:k,className:"w-16 h-16 bg-gray-800 text-gray-200 rounded-full font-medium hover:bg-gray-700 transition-all duration-200 flex items-center justify-center text-3xl",title:"Reset",children:"â†º"})]})]})})}export{M as TimerPage};
