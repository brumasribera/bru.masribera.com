var p=(e,i,t)=>new Promise((u,a)=>{var s=r=>{try{c(t.next(r))}catch(f){a(f)}},n=r=>{try{c(t.throw(r))}catch(f){a(f)}},c=r=>r.done?u(r.value):Promise.resolve(r.value).then(s,n);c((t=t.apply(e,i)).next())});import{r as o,j as d}from"./index-BQCk9SOP.js";const k={start:"/timer-sounds/start-gong.mp3",middle:"/timer-sounds/middle-gong.mp3",minute:"/timer-sounds/1m-gong.mp3",end:"/timer-sounds/end-gong.mp3"};function $(){const e=o.useRef(),i=o.useRef(),t=o.useRef({}),u=o.useRef(!1),a=()=>p(this,null,function*(){if(!u.current)try{e.current=new(window.AudioContext||window.webkitAudioContext),i.current=e.current.createGain(),i.current.gain.value=.3,i.current.connect(e.current.destination),console.log("🎵 Loading audio files...");for(const[n,c]of Object.entries(k))try{console.log(`🎵 Loading ${n}: ${c}`);const r=yield fetch(c);if(!r.ok){console.warn(`❌ Failed to fetch ${n}: ${r.status}`);continue}const f=yield r.arrayBuffer();t.current[n]=yield e.current.decodeAudioData(f),console.log(`✅ Loaded ${n} audio`)}catch(r){console.error(`❌ Error loading ${n}:`,r)}console.log("🎵 Audio system ready:",Object.keys(t.current)),u.current=!0}catch(n){console.error("❌ Failed to initialize audio system:",n)}}),s=o.useCallback(n=>p(this,null,function*(){if(console.log(`🔔 Attempting to play ${n} gong`),u.current||(yield a()),!e.current||!i.current){console.warn("❌ Audio system not initialized");return}if(!t.current[n]){console.warn(`❌ Audio buffer not loaded for ${n}`);return}e.current.state==="suspended"&&(console.log("🎵 Resuming suspended audio context"),yield e.current.resume());try{const c=e.current.createBufferSource();c.buffer=t.current[n],c.connect(i.current),c.onended=()=>{console.log(`✅ ${n} gong finished playing`)},c.start(0),console.log(`✅ Playing ${n} gong (duration: ${t.current[n].duration.toFixed(2)}s)`),console.log(`📊 ${n} gong buffer duration: ${t.current[n].duration.toFixed(2)}s`)}catch(c){console.error(`❌ Error playing ${n} gong:`,c)}}),[]);return o.useEffect(()=>()=>{e.current&&e.current.close()},[]),s}function j(){o.useEffect(()=>{document.title="Stretch Timer";const e=document.querySelector("link[rel*='icon']"),i=e==null?void 0:e.href;e&&(e.href="/favicons/favicon-timer.svg");const t=document.querySelector("link[rel='manifest']");t==null||t.remove();const u=document.createElement("link");u.rel="manifest",u.href=`/tools/timer/manifest.webmanifest?v=${Date.now()}`,document.head.appendChild(u);const a=(r,f)=>{const m=document.querySelector(`meta[name="${r}"]`);m&&m.remove();const g=document.createElement("meta");return g.name=r,g.content=f,document.head.appendChild(g),g},s=a("theme-color","#000000"),n=a("apple-mobile-web-app-capable","yes"),c=a("mobile-web-app-capable","yes");return"serviceWorker"in navigator&&navigator.serviceWorker.register("/sw.js").then(r=>console.log("✔ Service Worker registered",r)).catch(r=>console.error("❌ Service Worker error",r)),()=>{document.title="Bru Mas Ribera - Frontend & UX Engineer",e&&i&&(e.href=i),u.remove(),s.remove(),n.remove(),c.remove();const r=document.createElement("link");r.rel="manifest",r.href="/site.webmanifest",document.head.appendChild(r)}},[])}function E({active:e}){const[i,t]=o.useState([]),u=o.useRef(0),a=o.useRef();return o.useEffect(()=>{if(!e){t([]),clearInterval(a.current);return}return a.current=setInterval(()=>{const s={id:u.current++,left:`${Math.random()*100}%`,size:Math.random()*2+1,delay:0,duration:Math.random()*5+3,rotate:Math.random()*20-10};console.log("🌟 Generated star:",s),t(n=>[...n.slice(-300),s])},75),()=>clearInterval(a.current)},[e]),console.log("🌟 ShootingStars render - active:",e,"stars count:",i.length),d.jsxs("div",{className:"fixed inset-0 pointer-events-none z-10",children:[i.map(s=>d.jsx("div",{className:"absolute bg-white opacity-90 rounded-full",style:{top:"0px",left:s.left,width:`${s.size*2}px`,height:`${s.size*2}px`,animationDuration:`${s.duration}s`,animationName:"fall",animationFillMode:"forwards",animationTimingFunction:"linear"}},s.id)),d.jsx("style",{children:`
        @keyframes fall {
          0% { transform: translateY(-50px); opacity: 1; }
          100% { transform: translateY(100vh); opacity: 0; }
        }
      `})]})}const R=[420,360,300,240,180,120,60];function D(){const[e,i]=o.useState(480),[t,u]=o.useState(!1),[a,s]=o.useState(!1),[n,c]=o.useState(!1),[r,f]=o.useState(!1),m=o.useRef(0),g=o.useRef(),y=o.useRef({}),b=$();j(),o.useEffect(()=>{if(t)return g.current=setInterval(()=>{const l=Math.max(0,Math.ceil((m.current-Date.now())/1e3));if(i(l),l===0){v("end"),f(!0);return}if(R.includes(l)){const h=`gong_${l}`;y.current[h]||(y.current[h]=Date.now(),c(!0),b(l===240?"middle":"minute").catch(console.error),setTimeout(()=>c(!1),5e3))}},250),()=>clearInterval(g.current)},[t,b]),o.useEffect(()=>{const l=()=>{if(!document.hidden&&t&&m.current){const h=Math.max(0,Math.ceil((m.current-Date.now())/1e3));i(h),h===0&&!a&&v("end")}};return document.addEventListener("visibilitychange",l),()=>document.removeEventListener("visibilitychange",l)},[t,a]);const x=()=>p(this,null,function*(){a||e===0||(m.current=Date.now()+e*1e3,u(!0),s(!1),y.current={},f(!1),b("start"))}),v=l=>p(this,null,function*(){u(!1),l&&(yield b(l),l==="end"&&(s(!0),f(!0))),l!=="end"&&f(!1)}),w=()=>{v(),i(480),s(!1),y.current={}},S=l=>`${String(Math.floor(l/60)).padStart(2,"0")}:${String(l%60).padStart(2,"0")}`;return d.jsxs(d.Fragment,{children:[d.jsx("style",{children:`
          @keyframes timer-pulse-slow {
            0% { background-position: 0% 0%; }
            25% { background-position: 100% 0%; }
            50% { background-position: 100% 100%; }
            75% { background-position: 0% 100%; }
            100% { background-position: 0% 0%; }
          }
          @keyframes timer-pulse-fast {
            0% { background-position: 0% 0%; }
            25% { background-position: 100% 0%; }
            50% { background-position: 100% 100%; }
            75% { background-position: 0% 100%; }
            100% { background-position: 0% 0%; }
          }
          

        `}),d.jsxs("div",{className:`min-h-screen text-white font-mono flex flex-col items-center justify-center overflow-hidden relative ${n?"gong-playing":""}`,"data-timer-page":"true",style:{background:"linear-gradient(135deg, #000000 0%, #0a0a0a 20%, #0a0f1c 40%, #0a0a0a 60%, #0a0f1c 80%, #000000 100%)",backgroundSize:"150% 150%",animation:n?"timer-pulse-fast 8s ease-in-out infinite":"timer-pulse-slow 40s ease-in-out infinite"},children:[r&&d.jsx(E,{active:!0}),d.jsx("div",{className:"text-8xl mb-6 text-gray-300 tracking-wider font-light",children:S(e)}),d.jsxs("div",{className:"flex gap-6",children:[!t&&e>0&&!a&&d.jsx("button",{onClick:x,title:"Start",className:"w-16 h-16 bg-gray-700 hover:bg-gray-600 rounded-full flex items-center justify-center",children:d.jsx("div",{className:"w-0 h-0 border-l-[16px] border-t-[10px] border-b-[10px] border-transparent border-l-gray-200 ml-1"})}),t&&d.jsxs("button",{onClick:()=>v(),title:"Pause",className:"w-16 h-16 bg-gray-700 hover:bg-gray-600 rounded-full flex items-center justify-center gap-1",children:[d.jsx("div",{className:"w-1.5 h-6 bg-gray-200"}),d.jsx("div",{className:"w-1.5 h-6 bg-gray-200"})]}),d.jsx("button",{onClick:w,title:"Reset",className:"w-16 h-16 bg-gray-800 hover:bg-gray-700 rounded-full flex items-center justify-center text-3xl",children:"↺"})]})]})]})}function C(){const[e,i]=o.useState("v1.1.9"),[t,u]=o.useState("28 Thursday August 16:59");return o.useEffect(()=>{fetch(`/VERSION.json?v=${Date.now()}`).then(a=>a.json()).then(a=>{const s=new Date(a.timestamp+" UTC");i(`v${a.version}`),u(`${s.getDate()} ${s.toLocaleDateString("en-US",{weekday:"long"})} ${s.toLocaleDateString("en-US",{month:"long"})} ${s.toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit"})}`)}).catch(()=>{})},[]),{version:e,date:t}}export{D as TimerPage,$ as useAudio,j as usePWA,C as useVersion};
