var k=(m,x,d)=>new Promise((p,h)=>{var v=o=>{try{c(d.next(o))}catch(b){h(b)}},f=o=>{try{c(d.throw(o))}catch(b){h(b)}},c=o=>o.done?p(o.value):Promise.resolve(o.value).then(v,f);c((d=d.apply(m,x)).next())});import{r as s,j as l}from"./index-D6F13ayY.js";const C={start:"/timer-sounds/start-gong.mp3",middle:"/timer-sounds/middle-gong.mp3",minute:"/timer-sounds/1m-gong.mp3",end:"/timer-sounds/end-gong.mp3"};function N(){const[m,x]=s.useState(480),[d,p]=s.useState(!1),[h,v]=s.useState(!1),f=s.useRef(null),c=s.useRef({}),o=s.useRef(!1);s.useEffect(()=>{document.title="Stretch Timer",setTimeout(()=>{document.title="Stretch Timer"},100);const r=()=>{document.hidden||(document.title="Stretch Timer")};return document.addEventListener("visibilitychange",r),(()=>{document.querySelectorAll("link[rel='manifest']").forEach(a=>a.remove());const i=document.createElement("link");i.rel="manifest",i.href=`/tools/timer/manifest.webmanifest?v=${Date.now()}`,i.setAttribute("data-timer-manifest","true"),document.head.appendChild(i),console.log("Timer manifest set to:",i.href),console.log("Current path:",window.location.pathname)})(),(()=>{[{name:"mobile-web-app-capable",content:"yes"},{name:"apple-mobile-web-app-capable",content:"yes"},{name:"apple-mobile-web-app-status-bar-style",content:"black-translucent"},{name:"apple-mobile-web-app-title",content:"Stretch Timer"},{name:"application-name",content:"Stretch Timer"},{name:"msapplication-TileColor",content:"#000000"},{name:"msapplication-config",content:"/browserconfig.xml"},{name:"name",content:"Stretch Timer"},{name:"title",content:"Stretch Timer"}].forEach(i=>{if(!document.querySelector(`meta[name="${i.name}"]`)){const g=document.createElement("meta");g.name=i.name,g.content=i.content,document.head.appendChild(g)}})})(),(()=>{"serviceWorker"in navigator&&navigator.serviceWorker.register("/sw.js").then(n=>{console.log("Timer service worker registered:",n)}).catch(n=>{console.error("Timer service worker registration failed:",n)})})(),()=>{const n=document.querySelector("link[data-timer-manifest='true']");n&&n.remove();const i=document.createElement("link");i.rel="manifest",i.href="/site.webmanifest",document.head.appendChild(i),console.log("Restored original manifest:",i.href),["mobile-web-app-capable","apple-mobile-web-app-capable","apple-mobile-web-app-status-bar-style","apple-mobile-web-app-title","application-name","msapplication-TileColor","msapplication-config"].forEach(g=>{const y=document.querySelector(`meta[name="${g}"]`);y&&y.remove()}),document.title="Bru Mas Ribera - Frontend & UX Engineer",document.removeEventListener("visibilitychange",r),"serviceWorker"in navigator&&navigator.serviceWorker.getRegistrations().then(g=>{g.forEach(y=>{y.scope.includes("/tools/timer")&&(y.unregister(),console.log("Timer service worker unregistered"))})})}},[]),s.useEffect(()=>{(()=>{const t=document.querySelector("link[rel*='icon']");if(t)t.dataset.originalHref||(t.dataset.originalHref=t.href),t.href="/favicons/favicon-timer.svg";else{const n=document.createElement("link");n.type="image/svg+xml",n.rel="icon",n.href="/favicons/favicon-timer.svg",document.head.appendChild(n)}})();let e=!0;return k(this,null,function*(){for(const[t,n]of Object.entries(C)){if(!e)break;try{if(!(yield fetch(n)).ok)continue;if(!e)break;const a=new Audio(n);a.preload="auto",a.volume=.7,a.setAttribute("data-timer-audio","true"),a.addEventListener("error",()=>{}),a.addEventListener("canplaythrough",()=>{}),a.addEventListener("pause",()=>{}),a.addEventListener("play",()=>{}),a.addEventListener("ended",()=>{S()}),c.current[t]=a}catch(i){}}}),()=>{e=!1;const t=document.querySelector("link[rel*='icon']");t&&t.dataset.originalHref?(t.href=t.dataset.originalHref,delete t.dataset.originalHref):t&&t.href.includes("favicon-timer")&&(t.href="/favicon.ico"),Object.values(c.current).forEach(n=>{n.pause(),n.src=""}),c.current={}}},[]);const b=s.useCallback(()=>{const r=document.querySelectorAll("audio");let e=!1;return r.forEach(t=>{!t.hasAttribute("data-timer-audio")&&!t.paused&&(e=!0)}),document.querySelectorAll("video").forEach(t=>{!t.paused&&t.volume>0&&(e=!0)}),e},[]),S=s.useCallback(()=>{o.current&&setTimeout(()=>{const r=new Event("resume-audio",{bubbles:!0});document.dispatchEvent(r),o.current=!1},100)},[]),T=s.useCallback(()=>{!c.current||Object.keys(c.current).length===0||Object.entries(c.current).forEach(([r,e])=>{e.paused&&e.currentTime>0&&e.currentTime<e.duration&&e.play().catch(()=>{})})},[]);s.useEffect(()=>{const r=()=>{T()},e=()=>{document.hidden||T()};return window.addEventListener("focus",r),document.addEventListener("visibilitychange",e),()=>{window.removeEventListener("focus",r),document.removeEventListener("visibilitychange",e)}},[T]);const w=r=>{const e=c.current[r];if(e)try{o.current||(o.current=b()),e.currentTime=0,e.volume=.7,"mediaSession"in navigator&&(navigator.mediaSession.metadata=new MediaMetadata({title:"Timer Gong",artist:"Stretch Timer",album:"Meditation Sounds"}),navigator.mediaSession.setActionHandler("play",()=>{}),navigator.mediaSession.setActionHandler("pause",()=>{}));const u=e.play();u!==void 0&&u.catch(t=>{})}catch(u){}};s.useEffect(()=>(d&&m>0?f.current=setInterval(()=>{x(r=>{const e=r-1;return e>0&&e%60===0&&w("minute"),e===4*60&&w("middle"),e})},1e3):m===0&&!h&&(v(!0),p(!1),w("end")),()=>{f.current&&clearInterval(f.current)}),[d,m,h]);const j=()=>{m!==0&&(p(!0),v(!1),m===8*60&&w("start"))},E=()=>{p(!1),f.current&&clearInterval(f.current)},A=()=>{E(),x(8*60),v(!1),p(!1)},M=r=>{const e=Math.floor(r/60),u=r%60;return`${e.toString().padStart(2,"0")}:${u.toString().padStart(2,"0")}`};return l.jsx("div",{className:"min-h-screen bg-black flex items-center justify-center p-4",children:l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"text-8xl font-light text-gray-300 mb-8 font-mono tracking-wider",children:M(m)}),l.jsxs("div",{className:"flex gap-6 justify-center",children:[!d&&m>0&&!h&&l.jsx("button",{onClick:j,className:"w-16 h-16 bg-gray-700 text-gray-200 rounded-full font-medium hover:bg-gray-600 transition-all duration-200 flex items-center justify-center",title:"Start",children:l.jsx("div",{className:"w-0 h-0 border-l-[16px] border-l-gray-200 border-t-[10px] border-t-transparent border-b-[10px] border-b-transparent ml-1"})}),d&&l.jsxs("button",{onClick:E,className:"w-16 h-16 bg-gray-700 text-gray-200 rounded-full font-medium hover:bg-gray-600 transition-all duration-200 flex items-center justify-center gap-1",title:"Pause",children:[l.jsx("div",{className:"w-1.5 h-6 bg-gray-200 rounded-sm"}),l.jsx("div",{className:"w-1.5 h-6 bg-gray-200 rounded-sm"})]}),l.jsx("button",{onClick:A,className:"w-16 h-16 bg-gray-800 text-gray-200 rounded-full font-medium hover:bg-gray-700 transition-all duration-200 flex items-center justify-center text-3xl",title:"Reset",children:"â†º"})]})]})})}export{N as TimerPage};
