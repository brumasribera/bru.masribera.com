var p=(e,a,r)=>new Promise((l,s)=>{var o=t=>{try{c(r.next(t))}catch(f){s(f)}},n=t=>{try{c(r.throw(t))}catch(f){s(f)}},c=t=>t.done?l(t.value):Promise.resolve(t.value).then(o,n);c((r=r.apply(e,a)).next())});import{r as i,j as u}from"./index-BzQnWiWJ.js";const w={start:"/timer-sounds/start-gong.mp3",middle:"/timer-sounds/middle-gong.mp3",minute:"/timer-sounds/1m-gong.mp3",end:"/timer-sounds/end-gong.mp3"};function k(){const e=i.useRef(),a=i.useRef(),r=i.useRef({}),l=i.useRef(!1),s=()=>p(this,null,function*(){if(!l.current)try{e.current=new(window.AudioContext||window.webkitAudioContext),a.current=e.current.createGain(),a.current.gain.value=.3,a.current.connect(e.current.destination),console.log("ðŸŽµ Loading audio files...");for(const[n,c]of Object.entries(w))try{console.log(`ðŸŽµ Loading ${n}: ${c}`);const t=yield fetch(c);if(!t.ok){console.warn(`âŒ Failed to fetch ${n}: ${t.status}`);continue}const f=yield t.arrayBuffer();r.current[n]=yield e.current.decodeAudioData(f),console.log(`âœ… Loaded ${n} audio`)}catch(t){console.error(`âŒ Error loading ${n}:`,t)}console.log("ðŸŽµ Audio system ready:",Object.keys(r.current)),l.current=!0}catch(n){console.error("âŒ Failed to initialize audio system:",n)}}),o=i.useCallback(n=>p(this,null,function*(){if(console.log(`ðŸ”” Attempting to play ${n} gong`),l.current||(yield s()),!e.current||!a.current){console.warn("âŒ Audio system not initialized");return}if(!r.current[n]){console.warn(`âŒ Audio buffer not loaded for ${n}`);return}e.current.state==="suspended"&&(console.log("ðŸŽµ Resuming suspended audio context"),yield e.current.resume());try{const c=e.current.createBufferSource();c.buffer=r.current[n],c.connect(a.current),c.onended=()=>{console.log(`âœ… ${n} gong finished playing`)},c.start(0),console.log(`âœ… Playing ${n} gong (duration: ${r.current[n].duration.toFixed(2)}s)`),console.log(`ðŸ“Š ${n} gong buffer duration: ${r.current[n].duration.toFixed(2)}s`)}catch(c){console.error(`âŒ Error playing ${n} gong:`,c)}}),[]);return i.useEffect(()=>()=>{e.current&&e.current.close()},[]),o}function S(){i.useEffect(()=>{document.title="Stretch Timer";const e=document.querySelector("link[rel*='icon']"),a=e==null?void 0:e.href;e&&(e.href="/favicons/favicon-timer.svg");const r=document.querySelector("link[rel='manifest']");r==null||r.remove();const l=document.createElement("link");l.rel="manifest",l.href=`/tools/timer/manifest.webmanifest?v=${Date.now()}`,document.head.appendChild(l);const s=(t,f)=>{const g=document.querySelector(`meta[name="${t}"]`);g&&g.remove();const m=document.createElement("meta");return m.name=t,m.content=f,document.head.appendChild(m),m},o=s("theme-color","#000000"),n=s("apple-mobile-web-app-capable","yes"),c=s("mobile-web-app-capable","yes");return"serviceWorker"in navigator&&navigator.serviceWorker.register("/sw.js").then(t=>console.log("âœ” Service Worker registered",t)).catch(t=>console.error("âŒ Service Worker error",t)),()=>{document.title="Bru Mas Ribera - Frontend & UX Engineer",e&&a&&(e.href=a),l.remove(),o.remove(),n.remove(),c.remove();const t=document.createElement("link");t.rel="manifest",t.href="/site.webmanifest",document.head.appendChild(t)}},[])}function $({timerFinished:e}){const[a,r]=i.useState([]),l=i.useRef(0),s=i.useRef();return i.useEffect(()=>{if(e){clearInterval(s.current);return}return s.current=setInterval(()=>{const o={id:l.current++,left:`${Math.random()*100}%`,size:Math.random()*2+1,delay:0,duration:Math.random()*5+3,color:"#ffffff"};console.log("ðŸŒŸ Generated star:",o),r(n=>[...n.slice(-300),o])},75),()=>clearInterval(s.current)},[e]),console.log("ðŸŒŸ FallingStars render - timerFinished:",e,"stars count:",a.length),u.jsxs("div",{className:"fixed inset-0 pointer-events-none z-10",children:[a.map(o=>u.jsx("div",{className:"absolute opacity-90 rounded-full",style:{top:"0px",left:o.left,width:`${o.size*2}px`,height:`${o.size*2}px`,backgroundColor:o.color,animationDuration:`${o.duration}s`,animationName:"fall",animationFillMode:"forwards",animationTimingFunction:"linear"}},o.id)),u.jsx("style",{children:`
        @keyframes fall {
          0% { transform: translateY(-50px); opacity: 1; }
          100% { transform: translateY(100vh); opacity: 0; }
        }
      `})]})}const j=[420,360,300,240,180,120,60];function M(){const[e,a]=i.useState(480),[r,l]=i.useState(!1),[s,o]=i.useState(!1),[n,c]=i.useState(!1),t=i.useRef(0),f=i.useRef(),g=i.useRef({}),m=k();S(),i.useEffect(()=>{if(r)return f.current=setInterval(()=>{const d=Math.max(0,Math.ceil((t.current-Date.now())/1e3));if(a(d),d===0){y("end");return}if(j.includes(d)){const h=`gong_${d}`;g.current[h]||(g.current[h]=Date.now(),c(!0),m(d===240?"middle":"minute").catch(console.error),setTimeout(()=>c(!1),5e3))}},250),()=>clearInterval(f.current)},[r,m]),i.useEffect(()=>{const d=()=>{if(!document.hidden&&t.current){const h=Math.max(0,Math.ceil((t.current-Date.now())/1e3));a(h),h===0&&(s||y("end"))}};return document.addEventListener("visibilitychange",d),()=>document.removeEventListener("visibilitychange",d)},[r,s]);const b=()=>p(this,null,function*(){s||e===0||(t.current=Date.now()+e*1e3,l(!0),o(!1),g.current={},m("start"))}),y=d=>p(this,null,function*(){l(!1),d&&(yield m(d),d==="end"&&o(!0))}),v=()=>{y(),a(480),o(!1),g.current={}},x=d=>`${String(Math.floor(d/60)).padStart(2,"0")}:${String(d%60).padStart(2,"0")}`;return u.jsxs(u.Fragment,{children:[u.jsx("style",{children:`
          @keyframes timer-pulse-slow {
            0% { background-position: 0% 0%; }
            25% { background-position: 100% 0%; }
            50% { background-position: 100% 100%; }
            75% { background-position: 0% 100%; }
            100% { background-position: 0% 0%; }
          }
          @keyframes timer-pulse-fast {
            0% { background-position: 0% 0%; }
            25% { background-position: 100% 0%; }
            50% { background-position: 100% 100%; }
            75% { background-position: 0% 100%; }
            100% { background-position: 0% 0%; }
          }

          

        `}),u.jsxs("div",{className:`min-h-screen text-white font-mono flex flex-col items-center justify-center overflow-hidden relative ${n?"gong-playing":""}`,"data-timer-page":"true",style:{background:"linear-gradient(135deg, #000000 0%, #0a0a0a 20%, #0a0f1c 40%, #0a0a0a 60%, #0a0f1c 80%, #000000 100%)",backgroundSize:"150% 150%",animation:n?"timer-pulse-fast 8s ease-in-out infinite":"timer-pulse-slow 40s ease-in-out infinite"},children:[u.jsx($,{timerFinished:s}),u.jsx("div",{className:"text-8xl mb-6 text-gray-300 tracking-wider font-light",children:x(e)}),u.jsxs("div",{className:"flex gap-6",children:[!r&&e>0&&!s&&u.jsx("button",{onClick:b,title:"Start",className:"w-16 h-16 bg-gray-700 hover:bg-gray-600 rounded-full flex items-center justify-center",children:u.jsx("svg",{className:"w-10 h-10 text-gray-200",viewBox:"0 0 24 24",fill:"currentColor",children:u.jsx("path",{d:"M8 5.5c0-0.3 0.2-0.5 0.5-0.5l11 6.5c0.3 0.2 0.3 0.6 0 0.8l-11 6.5c-0.3 0.2-0.5 0-0.5-0.3V5.5z"})})}),r&&u.jsxs("button",{onClick:()=>y(),title:"Pause",className:"w-16 h-16 bg-gray-700 hover:bg-gray-600 rounded-full flex items-center justify-center gap-1",children:[u.jsx("div",{className:"w-1.5 h-6 bg-gray-200 rounded-sm"}),u.jsx("div",{className:"w-1.5 h-6 bg-gray-200 rounded-sm"})]}),u.jsx("button",{onClick:v,title:"Reset",className:"w-16 h-16 bg-gray-800 hover:bg-gray-700 rounded-full flex items-center justify-center text-4xl",children:"â†º"})]})]})]})}function C(){const[e,a]=i.useState("v1.1.9"),[r,l]=i.useState("28 Thursday August 16:59");return i.useEffect(()=>{fetch(`/VERSION.json?v=${Date.now()}`).then(s=>s.json()).then(s=>{const o=new Date(s.timestamp+" UTC");a(`v${s.version}`),l(`${o.getDate()} ${o.toLocaleDateString("en-US",{weekday:"long"})} ${o.toLocaleDateString("en-US",{month:"long"})} ${o.toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit"})}`)}).catch(()=>{})},[]),{version:e,date:r}}export{M as TimerPage,k as useAudio,S as usePWA,C as useVersion};
