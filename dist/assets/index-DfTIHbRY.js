var g=(e,i,t)=>new Promise((c,r)=>{var l=o=>{try{a(t.next(o))}catch(f){r(f)}},n=o=>{try{a(t.throw(o))}catch(f){r(f)}},a=o=>o.done?c(o.value):Promise.resolve(o.value).then(l,n);a((t=t.apply(e,i)).next())});import{r as s,j as d}from"./index-Bdy-IcV4.js";const v={start:"/timer-sounds/start-gong.mp3",middle:"/timer-sounds/middle-gong.mp3",minute:"/timer-sounds/1m-gong.mp3",end:"/timer-sounds/end-gong.mp3"};function S(){const e=s.useRef(),i=s.useRef(),t=s.useRef({}),c=s.useRef(!1),r=()=>g(this,null,function*(){if(!c.current)try{e.current=new(window.AudioContext||window.webkitAudioContext),i.current=e.current.createGain(),i.current.gain.value=.3,i.current.connect(e.current.destination),console.log("🎵 Loading audio files...");for(const[n,a]of Object.entries(v))try{console.log(`🎵 Loading ${n}: ${a}`);const o=yield fetch(a);if(!o.ok){console.warn(`❌ Failed to fetch ${n}: ${o.status}`);continue}const f=yield o.arrayBuffer();t.current[n]=yield e.current.decodeAudioData(f),console.log(`✅ Loaded ${n} audio`)}catch(o){console.error(`❌ Error loading ${n}:`,o)}console.log("🎵 Audio system ready:",Object.keys(t.current)),c.current=!0}catch(n){console.error("❌ Failed to initialize audio system:",n)}}),l=s.useCallback(n=>g(this,null,function*(){if(console.log(`🔔 Attempting to play ${n} gong`),c.current||(yield r()),!e.current||!i.current){console.warn("❌ Audio system not initialized");return}if(!t.current[n]){console.warn(`❌ Audio buffer not loaded for ${n}`);return}e.current.state==="suspended"&&(console.log("🎵 Resuming suspended audio context"),yield e.current.resume());try{const a=e.current.createBufferSource();a.buffer=t.current[n],a.connect(i.current),a.start(0),console.log(`✅ Playing ${n} gong`)}catch(a){console.error(`❌ Error playing ${n} gong:`,a)}}),[]);return s.useEffect(()=>()=>{e.current&&e.current.close()},[]),l}function j(){s.useEffect(()=>{document.title="Stretch Timer";const e=document.querySelector("link[rel*='icon']"),i=e==null?void 0:e.href;e&&(e.href="/favicons/favicon-timer.svg");const t=document.querySelector("link[rel='manifest']");t==null||t.remove();const c=document.createElement("link");return c.rel="manifest",c.href=`/tools/timer/manifest.webmanifest?v=${Date.now()}`,document.head.appendChild(c),"serviceWorker"in navigator&&navigator.serviceWorker.register("/sw.js").catch(()=>{}),()=>{document.title="Bru Mas Ribera - Frontend & UX Engineer",e&&i&&(e.href=i),c.remove();const r=document.createElement("link");r.rel="manifest",r.href="/site.webmanifest",document.head.appendChild(r)}},[])}function $(){const[e,i]=s.useState("v1.1.9"),[t,c]=s.useState("28 Thursday August 16:59");return s.useEffect(()=>{fetch(`/VERSION.json?v=${Date.now()}`).then(r=>r.json()).then(r=>{const l=new Date(r.timestamp+" UTC");i(`v${r.version}`),c(`${l.getDate()} ${l.toLocaleDateString("en-US",{weekday:"long"})} ${l.toLocaleDateString("en-US",{month:"long"})} ${l.toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit"})}`)}).catch(()=>{})},[]),{version:e,date:t}}const k=[420,360,300,240,180,120,60];function D(){const[e,i]=s.useState(480),[t,c]=s.useState(!1),[r,l]=s.useState(!1),n=s.useRef(0),a=s.useRef(),o=s.useRef({}),f=S(),{version:y,date:b}=$();j(),s.useEffect(()=>{if(t)return a.current=setInterval(()=>{const u=Math.max(0,Math.ceil((n.current-Date.now())/1e3));if(i(u),u===0)return h("end");if(k.includes(u)){const m=`gong_${u}`;o.current[m]||(o.current[m]=Date.now(),f(u===240?"middle":"minute").catch(console.error))}},250),()=>clearInterval(a.current)},[t,f]),s.useEffect(()=>{const u=()=>{if(!document.hidden&&t&&n.current){const m=Math.max(0,Math.ceil((n.current-Date.now())/1e3));i(m),m===0&&!r&&h("end")}};return document.addEventListener("visibilitychange",u),()=>document.removeEventListener("visibilitychange",u)},[t,r]);const w=()=>g(this,null,function*(){r||e===0||(n.current=Date.now()+e*1e3,c(!0),l(!1),o.current={},yield f("start"))}),h=u=>g(this,null,function*(){c(!1),u&&(yield f(u),l(!0))}),x=()=>{h(),i(480),l(!1),o.current={}},p=u=>`${String(Math.floor(u/60)).padStart(2,"0")}:${String(u%60).padStart(2,"0")}`;return d.jsxs("div",{className:"min-h-screen bg-black text-white font-mono flex flex-col items-center justify-center",children:[d.jsx("div",{className:"text-8xl mb-6 text-gray-300 tracking-wider font-light",children:p(e)}),d.jsxs("div",{className:"flex gap-6",children:[!t&&e>0&&!r&&d.jsx("button",{onClick:w,title:"Start",className:"w-16 h-16 bg-gray-700 hover:bg-gray-600 rounded-full flex items-center justify-center",children:d.jsx("div",{className:"w-0 h-0 border-l-[16px] border-t-[10px] border-b-[10px] border-transparent border-l-gray-200 ml-1"})}),t&&d.jsxs("button",{onClick:()=>h(),title:"Pause",className:"w-16 h-16 bg-gray-700 hover:bg-gray-600 rounded-full flex items-center justify-center gap-1",children:[d.jsx("div",{className:"w-1.5 h-6 bg-gray-200"}),d.jsx("div",{className:"w-1.5 h-6 bg-gray-200"})]}),d.jsx("button",{onClick:x,title:"Reset",className:"w-16 h-16 bg-gray-800 hover:bg-gray-700 rounded-full flex items-center justify-center text-3xl",children:"↺"})]}),d.jsx("div",{className:"mt-6",children:d.jsxs("span",{className:"inline-block bg-purple-600 text-white text-sm px-4 py-2 rounded-lg font-mono border-2 border-purple-400 shadow-lg",children:["🚀 ",y," • ",b]})})]})}export{D as TimerPage,S as useAudio,j as usePWA,$ as useVersion};
