var T=(m,x,d)=>new Promise((h,b)=>{var v=s=>{try{a(d.next(s))}catch(u){b(u)}},f=s=>{try{a(d.throw(s))}catch(u){b(u)}},a=s=>s.done?h(s.value):Promise.resolve(s.value).then(v,f);a((d=d.apply(m,x)).next())});import{r as c,j as l}from"./index-BchSBVR1.js";const j={start:"/timer-sounds/start-gong.mp3",middle:"/timer-sounds/middle-gong.mp3",minute:"/timer-sounds/1m-gong.mp3",end:"/timer-sounds/end-gong.mp3"};function L(){const[m,x]=c.useState(480),[d,h]=c.useState(!1),[b,v]=c.useState(!1),f=c.useRef(null),a=c.useRef({});c.useEffect(()=>{document.title="Stretch Timer",setTimeout(()=>{document.title="Stretch Timer"},100);const i=()=>{document.hidden||(document.title="Stretch Timer")};return document.addEventListener("visibilitychange",i),(()=>{document.querySelectorAll("link[rel='manifest']").forEach(o=>o.remove());const r=document.createElement("link");r.rel="manifest",r.href=`/tools/timer/manifest.webmanifest?v=${Date.now()}`,r.setAttribute("data-timer-manifest","true"),document.head.appendChild(r),console.log("Timer manifest set to:",r.href),console.log("Current path:",window.location.pathname)})(),(()=>{[{name:"mobile-web-app-capable",content:"yes"},{name:"apple-mobile-web-app-capable",content:"yes"},{name:"apple-mobile-web-app-status-bar-style",content:"black-translucent"},{name:"apple-mobile-web-app-title",content:"Stretch Timer"},{name:"application-name",content:"Stretch Timer"},{name:"msapplication-TileColor",content:"#000000"},{name:"msapplication-config",content:"/browserconfig.xml"},{name:"name",content:"Stretch Timer"},{name:"title",content:"Stretch Timer"}].forEach(r=>{if(!document.querySelector(`meta[name="${r.name}"]`)){const g=document.createElement("meta");g.name=r.name,g.content=r.content,document.head.appendChild(g)}})})(),(()=>{"serviceWorker"in navigator&&navigator.serviceWorker.register("/sw.js").then(t=>{console.log("Timer service worker registered:",t)}).catch(t=>{console.error("Timer service worker registration failed:",t)})})(),()=>{const t=document.querySelector("link[data-timer-manifest='true']");t&&t.remove();const r=document.createElement("link");r.rel="manifest",r.href="/site.webmanifest",document.head.appendChild(r),console.log("Restored original manifest:",r.href),["mobile-web-app-capable","apple-mobile-web-app-capable","apple-mobile-web-app-status-bar-style","apple-mobile-web-app-title","application-name","msapplication-TileColor","msapplication-config"].forEach(g=>{const y=document.querySelector(`meta[name="${g}"]`);y&&y.remove()}),document.title="Bru Mas Ribera - Frontend & UX Engineer",document.removeEventListener("visibilitychange",i),"serviceWorker"in navigator&&navigator.serviceWorker.getRegistrations().then(g=>{g.forEach(y=>{y.scope.includes("/tools/timer")&&(y.unregister(),console.log("Timer service worker unregistered"))})})}},[]),c.useEffect(()=>{(()=>{const n=document.querySelector("link[rel*='icon']");if(n)n.dataset.originalHref||(n.dataset.originalHref=n.href),n.href="/favicons/favicon-timer.svg";else{const t=document.createElement("link");t.type="image/svg+xml",t.rel="icon",t.href="/favicons/favicon-timer.svg",document.head.appendChild(t)}})();let e=!0;return T(this,null,function*(){for(const[n,t]of Object.entries(j)){if(!e)break;try{if(!(yield fetch(t)).ok)continue;if(!e)break;const o=new Audio(t);o.preload="auto",o.volume=1,a.current[n]=o,o.addEventListener("error",()=>{}),o.addEventListener("canplaythrough",()=>{}),o.addEventListener("pause",()=>{}),o.addEventListener("play",()=>{})}catch(r){}}}),()=>{e=!1;const n=document.querySelector("link[rel*='icon']");n&&n.dataset.originalHref?(n.href=n.dataset.originalHref,delete n.dataset.originalHref):n&&n.href.includes("favicon-timer")&&(n.href="/favicon.ico"),Object.values(a.current).forEach(t=>{t.pause(),t.src=""}),a.current={}}},[]);const s=c.useCallback(()=>{!a.current||Object.keys(a.current).length===0||Object.entries(a.current).forEach(([i,e])=>{e.paused&&e.currentTime>0&&e.currentTime<e.duration&&e.play().catch(()=>{})})},[]);c.useEffect(()=>{const i=()=>{s()},e=()=>{document.hidden||s()};return window.addEventListener("focus",i),document.addEventListener("visibilitychange",e),()=>{window.removeEventListener("focus",i),document.removeEventListener("visibilitychange",e)}},[s]);const u=i=>{const e=a.current[i];if(e)try{e.currentTime=0,e.volume=1;const p=e.play();p!==void 0&&p.catch(n=>{})}catch(p){}};c.useEffect(()=>(d&&m>0?f.current=setInterval(()=>{x(i=>{const e=i-1;return e>0&&e%60===0&&u("minute"),e===4*60&&u("middle"),e})},1e3):m===0&&!b&&(v(!0),h(!1),u("end")),()=>{f.current&&clearInterval(f.current)}),[d,m,b]);const k=()=>{m!==0&&(h(!0),v(!1),m===8*60&&u("start"))},w=()=>{h(!1),f.current&&clearInterval(f.current)},E=()=>{w(),x(8*60),v(!1),h(!1)},S=i=>{const e=Math.floor(i/60),p=i%60;return`${e.toString().padStart(2,"0")}:${p.toString().padStart(2,"0")}`};return l.jsx("div",{className:"min-h-screen bg-black flex items-center justify-center p-4",children:l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"text-8xl font-light text-gray-300 mb-8 font-mono tracking-wider",children:S(m)}),l.jsxs("div",{className:"flex gap-6 justify-center",children:[!d&&m>0&&!b&&l.jsx("button",{onClick:k,className:"w-16 h-16 bg-gray-700 text-gray-200 rounded-full font-medium hover:bg-gray-600 transition-all duration-200 flex items-center justify-center",title:"Start",children:l.jsx("div",{className:"w-0 h-0 border-l-[16px] border-l-gray-200 border-t-[10px] border-t-transparent border-b-[10px] border-b-transparent ml-1"})}),d&&l.jsxs("button",{onClick:w,className:"w-16 h-16 bg-gray-700 text-gray-200 rounded-full font-medium hover:bg-gray-600 transition-all duration-200 flex items-center justify-center gap-1",title:"Pause",children:[l.jsx("div",{className:"w-1.5 h-6 bg-gray-200 rounded-sm"}),l.jsx("div",{className:"w-1.5 h-6 bg-gray-200 rounded-sm"})]}),l.jsx("button",{onClick:E,className:"w-16 h-16 bg-gray-800 text-gray-200 rounded-full font-medium hover:bg-gray-700 transition-all duration-200 flex items-center justify-center text-3xl",title:"Reset",children:"â†º"})]})]})})}export{L as TimerPage};
