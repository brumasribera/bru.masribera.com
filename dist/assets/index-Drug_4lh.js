var E=(f,x,l)=>new Promise((g,u)=>{var b=d=>{try{k(l.next(d))}catch(T){u(T)}},A=d=>{try{k(l.throw(d))}catch(T){u(T)}},k=d=>d.done?g(d.value):Promise.resolve(d.value).then(b,A);k((l=l.apply(f,x)).next())});import{r as o,j as c}from"./index-D1EBDj3s.js";const P={start:"/timer-sounds/start-gong.mp3",middle:"/timer-sounds/middle-gong.mp3",minute:"/timer-sounds/1m-gong.mp3",end:"/timer-sounds/end-gong.mp3"};function q(){const[f,x]=o.useState(480),[l,g]=o.useState(!1),[u,b]=o.useState(!1),[A,k]=o.useState("v1.1.9"),[d,T]=o.useState("28 Thursday August 16:59"),j=o.useRef(null),w=o.useRef(null),p=o.useRef({}),M=o.useRef(0),S=o.useRef(null),s=o.useRef(null),v=o.useRef(null),R=o.useRef({}),$=o.useCallback(()=>E(this,null,function*(){try{s.current=new(window.AudioContext||window.webkitAudioContext),v.current=s.current.createGain(),v.current.gain.value=.3,v.current.connect(s.current.destination),console.log("Web Audio API system initialized")}catch(t){console.error("Failed to initialize Web Audio API:",t)}}),[]),D=o.useCallback(t=>E(this,null,function*(){if(s.current||(yield $()),!s.current)return console.error("Audio context not available"),null;try{const e=yield fetch(t);if(!e.ok)throw new Error(`Failed to fetch audio: ${e.status}`);const r=yield e.arrayBuffer();return yield s.current.decodeAudioData(r)}catch(e){return console.error(`Failed to decode audio file ${t}:`,e),null}}),[$]);o.useEffect(()=>{E(this,null,function*(){try{const r=yield(yield fetch(`/VERSION.json?v=${Date.now()}`)).json(),n=new Date(r.timestamp+" UTC"),i=n.getDate(),a=n.toLocaleDateString("en-US",{weekday:"long"}),h=n.toLocaleDateString("en-US",{month:"long"}),m=n.toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit"});k(`v${r.version}`),T(`${i} ${a} ${h} ${m}`)}catch(e){console.warn("Failed to load version info:",e)}})},[]),o.useEffect(()=>{document.title="Stretch Timer",setTimeout(()=>{document.title="Stretch Timer"},100);const t=()=>{document.hidden||(document.title="Stretch Timer")};return document.addEventListener("visibilitychange",t),(()=>{document.querySelectorAll("link[rel='manifest']").forEach(h=>h.remove());const a=document.createElement("link");a.rel="manifest",a.href=`/tools/timer/manifest.webmanifest?v=${Date.now()}`,a.setAttribute("data-timer-manifest","true"),document.head.appendChild(a),console.log("Timer manifest set to:",a.href),console.log("Current path:",window.location.pathname)})(),(()=>{[{name:"mobile-web-app-capable",content:"yes"},{name:"apple-mobile-web-app-capable",content:"yes"},{name:"apple-mobile-web-app-status-bar-style",content:"black-translucent"},{name:"apple-mobile-web-app-title",content:"Stretch Timer"},{name:"application-name",content:"Stretch Timer"},{name:"msapplication-TileColor",content:"#000000"},{name:"msapplication-config",content:"/browserconfig.xml"},{name:"name",content:"Stretch Timer"},{name:"title",content:"Stretch Timer"}].forEach(a=>{if(!document.querySelector(`meta[name="${a.name}"]`)){const m=document.createElement("meta");m.name=a.name,m.content=a.content,document.head.appendChild(m)}})})(),(()=>{"serviceWorker"in navigator&&navigator.serviceWorker.register("/sw.js").then(i=>{var a;console.log("Timer service worker registered:",i),i.waiting&&i.waiting.postMessage({type:"SKIP_WAITING"}),(a=i.active)==null||a.postMessage({type:"VERSION_CHECK",version:"1.1.7"})}).catch(i=>{console.error("Timer service worker registration failed:",i)})})(),()=>{const i=document.querySelector("link[data-timer-manifest='true']");i&&i.remove();const a=document.createElement("link");a.rel="manifest",a.href="/site.webmanifest",document.head.appendChild(a),console.log("Restored original manifest:",a.href),["mobile-web-app-capable","apple-mobile-web-app-capable","apple-mobile-web-app-status-bar-style","apple-mobile-web-app-title","application-name","msapplication-TileColor","msapplication-config"].forEach(m=>{const C=document.querySelector(`meta[name="${m}"]`);C&&C.remove()}),document.title="Bru Mas Ribera - Frontend & UX Engineer",document.removeEventListener("visibilitychange",t),"serviceWorker"in navigator&&navigator.serviceWorker.getRegistrations().then(m=>{m.forEach(C=>{C.scope.includes("/tools/timer")&&(C.unregister(),console.log("Timer service worker unregistered"))})})}},[]),o.useEffect(()=>{(()=>{const n=document.querySelector("link[rel*='icon']");if(n)n.dataset.originalHref||(n.dataset.originalHref=n.href),n.href="/favicons/favicon-timer.svg";else{const i=document.createElement("link");i.type="image/svg+xml",i.rel="icon",i.href="/favicons/favicon-timer.svg",document.head.appendChild(i)}})();let e=!0;return E(this,null,function*(){for(const[n,i]of Object.entries(P)){if(!e)break;try{if(!(yield fetch(i)).ok)continue;if(!e)break;const h=yield D(i);h&&(R.current[n]=h)}catch(a){}}}),()=>{e=!1;const n=document.querySelector("link[rel*='icon']");n&&n.dataset.originalHref?(n.href=n.dataset.originalHref,delete n.dataset.originalHref):n&&n.href.includes("favicon-timer")&&(n.href="/favicon.ico"),s.current&&(s.current.close(),s.current=null),v.current=null,R.current={}}},[]);const N=o.useCallback(()=>{!R.current||Object.keys(R.current).length===0||s.current&&s.current.state==="suspended"&&s.current.resume()},[]);o.useEffect(()=>{const t=()=>{N()},e=()=>{if(!document.hidden&&(N(),l&&j.current&&w.current)){const r=Date.now(),n=Math.max(0,Math.ceil((w.current-r)/1e3));x(n),n===0&&!u&&(b(!0),g(!1),y("end"))}};return window.addEventListener("focus",t),document.addEventListener("visibilitychange",e),()=>{window.removeEventListener("focus",t),document.removeEventListener("visibilitychange",e)}},[N,l,u]);const y=o.useCallback(t=>{if(!s.current||!v.current){console.warn("Audio system not initialized");return}const e=R.current[t];if(!e){console.warn(`Audio buffer not loaded for ${t}`);return}try{s.current.state==="suspended"&&s.current.resume();const r=s.current.createBufferSource();r.buffer=e,r.connect(v.current),r.start(0),console.log(`Playing ${t} gong`)}catch(r){console.error(`Failed to play ${t} gong:`,r)}},[]);o.useEffect(()=>(l&&j.current&&w.current?S.current=setInterval(()=>{const t=Date.now(),e=Math.max(0,Math.ceil((w.current-t)/1e3));x(e),L(e),e===0&&!u&&(b(!0),g(!1),y("end"))},100):f===0&&!u&&(b(!0),g(!1),y("end")),()=>{S.current&&clearInterval(S.current)}),[l,f,u]);const L=o.useCallback(t=>{const e=Date.now();if(!(e-M.current<500)){if(M.current=e,t===7*60-1){const r="start_gong";p.current[r]||(p.current[r]=e,y("start"))}if(t===4*60){const r="middle_4min";p.current[r]||(p.current[r]=e,y("middle"))}if(t>0&&t%60===0&&t!==4*60){const r=`minute_${t}`;p.current[r]||(p.current[r]=e,y("minute"))}}},[]),F=()=>{if(f===0)return;const t=Date.now(),e=f*1e3;j.current=t,w.current=t+e,p.current={},M.current=0,g(!0),b(!1)},I=()=>{g(!1),j.current=null,w.current=null,S.current&&clearInterval(S.current)},W=()=>{I(),x(8*60),b(!1),g(!1),p.current={},M.current=0},B=t=>{const e=Math.floor(t/60),r=t%60;return`${e.toString().padStart(2,"0")}:${r.toString().padStart(2,"0")}`};return c.jsx("div",{className:"min-h-screen bg-black flex items-center justify-center p-4",children:c.jsxs("div",{className:"text-center",children:[c.jsx("div",{className:"text-8xl font-light text-gray-300 mb-8 font-mono tracking-wider",children:B(f)}),c.jsxs("div",{className:"flex gap-6 justify-center",children:[!l&&f>0&&!u&&c.jsx("button",{onClick:F,className:"w-16 h-16 bg-gray-700 text-gray-200 rounded-full font-medium hover:bg-gray-600 transition-all duration-200 flex items-center justify-center",title:"Start",children:c.jsx("div",{className:"w-0 h-0 border-l-[16px] border-l-gray-200 border-t-[10px] border-t-transparent border-b-[10px] border-b-transparent ml-1"})}),l&&c.jsxs("button",{onClick:I,className:"w-16 h-16 bg-gray-700 text-gray-200 rounded-full font-medium hover:bg-gray-600 transition-all duration-200 flex items-center justify-center gap-1",title:"Pause",children:[c.jsx("div",{className:"w-1.5 h-6 bg-gray-200 rounded-sm"}),c.jsx("div",{className:"w-1.5 h-6 bg-gray-200 rounded-sm"})]}),c.jsx("button",{onClick:W,className:"w-16 h-16 bg-gray-800 text-gray-200 rounded-full font-medium hover:bg-gray-700 transition-all duration-200 flex items-center justify-center text-3xl",title:"Reset",children:"â†º"})]}),c.jsx("div",{className:"mt-6 text-center",children:c.jsxs("span",{className:"inline-block bg-purple-600 text-white text-sm px-4 py-2 rounded-lg font-mono border-2 border-purple-400 shadow-lg",children:["ðŸš€ ",A," â€¢ ",d]})})]})})}export{q as TimerPage};
