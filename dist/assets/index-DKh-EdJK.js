var H=(u,w,l)=>new Promise((g,m)=>{var p=d=>{try{S(l.next(d))}catch(k){m(k)}},C=d=>{try{S(l.throw(d))}catch(k){m(k)}},S=d=>d.done?g(d.value):Promise.resolve(d.value).then(p,C);S((l=l.apply(u,w)).next())});import{r as i,j as c}from"./index-0DzPFbYS.js";const L={start:"/timer-sounds/start-gong.mp3",middle:"/timer-sounds/middle-gong.mp3",minute:"/timer-sounds/1m-gong.mp3",end:"/timer-sounds/end-gong.mp3"};function U(){const[u,w]=i.useState(480),[l,g]=i.useState(!1),[m,p]=i.useState(!1),[C,S]=i.useState("v1.1.9"),[d,k]=i.useState("28 Thursday August 16:59"),A=i.useRef(null),h=i.useRef(null),b=i.useRef({}),M=i.useRef(0),T=i.useRef(null),v=i.useRef({}),R=i.useRef(!1),x=i.useRef({});i.useEffect(()=>{H(this,null,function*(){try{const r=yield(yield fetch(`/VERSION.json?v=${Date.now()}`)).json(),t=new Date(r.timestamp+" UTC"),n=t.getDate(),s=t.toLocaleDateString("en-US",{weekday:"long"}),o=t.toLocaleDateString("en-US",{month:"long"}),f=t.toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit"});S(`v${r.version}`),k(`${n} ${s} ${o} ${f}`)}catch(e){console.warn("Failed to load version info:",e)}})},[]),i.useEffect(()=>{document.title="Stretch Timer",setTimeout(()=>{document.title="Stretch Timer"},100);const a=()=>{document.hidden||(document.title="Stretch Timer")};return document.addEventListener("visibilitychange",a),(()=>{document.querySelectorAll("link[rel='manifest']").forEach(o=>o.remove());const s=document.createElement("link");s.rel="manifest",s.href=`/tools/timer/manifest.webmanifest?v=${Date.now()}`,s.setAttribute("data-timer-manifest","true"),document.head.appendChild(s),console.log("Timer manifest set to:",s.href),console.log("Current path:",window.location.pathname)})(),(()=>{[{name:"mobile-web-app-capable",content:"yes"},{name:"apple-mobile-web-app-capable",content:"yes"},{name:"apple-mobile-web-app-status-bar-style",content:"black-translucent"},{name:"apple-mobile-web-app-title",content:"Stretch Timer"},{name:"application-name",content:"Stretch Timer"},{name:"msapplication-TileColor",content:"#000000"},{name:"msapplication-config",content:"/browserconfig.xml"},{name:"name",content:"Stretch Timer"},{name:"title",content:"Stretch Timer"}].forEach(s=>{if(!document.querySelector(`meta[name="${s.name}"]`)){const f=document.createElement("meta");f.name=s.name,f.content=s.content,document.head.appendChild(f)}})})(),(()=>{"serviceWorker"in navigator&&navigator.serviceWorker.register("/sw.js").then(n=>{var s;console.log("Timer service worker registered:",n),n.waiting&&n.waiting.postMessage({type:"SKIP_WAITING"}),(s=n.active)==null||s.postMessage({type:"VERSION_CHECK",version:"1.1.7"})}).catch(n=>{console.error("Timer service worker registration failed:",n)})})(),()=>{const n=document.querySelector("link[data-timer-manifest='true']");n&&n.remove();const s=document.createElement("link");s.rel="manifest",s.href="/site.webmanifest",document.head.appendChild(s),console.log("Restored original manifest:",s.href),["mobile-web-app-capable","apple-mobile-web-app-capable","apple-mobile-web-app-status-bar-style","apple-mobile-web-app-title","application-name","msapplication-TileColor","msapplication-config"].forEach(f=>{const E=document.querySelector(`meta[name="${f}"]`);E&&E.remove()}),document.title="Bru Mas Ribera - Frontend & UX Engineer",document.removeEventListener("visibilitychange",a),"serviceWorker"in navigator&&navigator.serviceWorker.getRegistrations().then(f=>{f.forEach(E=>{E.scope.includes("/tools/timer")&&(E.unregister(),console.log("Timer service worker unregistered"))})})}},[]),i.useEffect(()=>{(()=>{const t=document.querySelector("link[rel*='icon']");if(t)t.dataset.originalHref||(t.dataset.originalHref=t.href),t.href="/favicons/favicon-timer.svg";else{const n=document.createElement("link");n.type="image/svg+xml",n.rel="icon",n.href="/favicons/favicon-timer.svg",document.head.appendChild(n)}})();let e=!0;return H(this,null,function*(){for(const[t,n]of Object.entries(L)){if(!e)break;try{if(!(yield fetch(n)).ok)continue;if(!e)break;const o=P(n);o.addEventListener("error",()=>{}),o.addEventListener("canplaythrough",()=>{}),o.addEventListener("pause",()=>{}),o.addEventListener("play",()=>{}),o.addEventListener("ended",()=>{I()}),v.current[t]=o}catch(s){}}}),()=>{e=!1;const t=document.querySelector("link[rel*='icon']");t&&t.dataset.originalHref?(t.href=t.dataset.originalHref,delete t.dataset.originalHref):t&&t.href.includes("favicon-timer")&&(t.href="/favicon.ico"),Object.values(v.current).forEach(n=>{n.pause(),n.src=""}),v.current={}}},[]);const D=i.useCallback(()=>{const a=document.querySelectorAll("audio");let e=!1;return x.current={},a.forEach((t,n)=>{!t.hasAttribute("data-timer-audio")&&!t.paused&&(e=!0,x.current[`audio_${n}`]={element:t,wasPlaying:!0,currentTime:t.currentTime,volume:t.volume})}),document.querySelectorAll("video").forEach((t,n)=>{!t.paused&&t.volume>0&&(e=!0,x.current[`video_${n}`]={element:t,wasPlaying:!0,currentTime:t.currentTime,volume:t.volume})}),e},[]),I=i.useCallback(()=>{R.current&&setTimeout(()=>{Object.values(x.current).forEach(e=>{if(e.wasPlaying&&e.element)try{if(e.element.tagName==="AUDIO"||e.element.tagName==="VIDEO"){e.element.currentTime=e.currentTime,e.element.volume=e.volume;const r=e.element.play();r!==void 0&&r.catch(()=>{})}}catch(r){}});const a=new Event("resume-audio",{bubbles:!0});document.dispatchEvent(a),"mediaSession"in navigator&&(navigator.mediaSession.playbackState="none",navigator.mediaSession.metadata=null),window.dispatchEvent(new Event("focus")),document.dispatchEvent(new Event("visibilitychange")),R.current=!1,x.current={}},100)},[]);i.useCallback(()=>{"mediaSession"in navigator&&(navigator.mediaSession.metadata=new MediaMetadata({title:"Timer Gong",artist:"Stretch Timer",album:"Meditation Sounds"}),navigator.mediaSession.playbackState="none",navigator.mediaSession.setActionHandler("play",()=>{}),navigator.mediaSession.setActionHandler("pause",()=>{}),navigator.mediaSession.setActionHandler("stop",()=>{}),navigator.mediaSession.setActionHandler("seekbackward",()=>{}),navigator.mediaSession.setActionHandler("seekforward",()=>{}),navigator.mediaSession.setActionHandler("seekto",()=>{}),navigator.mediaSession.setActionHandler("previoustrack",()=>{}),navigator.mediaSession.setActionHandler("nexttrack",()=>{}))},[]);const O=i.useCallback(()=>{if("mediaSession"in navigator&&(navigator.mediaSession.metadata=new MediaMetadata({title:"Timer Gong",artist:"Stretch Timer",album:"Meditation Sounds"}),navigator.mediaSession.playbackState="none",navigator.mediaSession.setActionHandler("play",()=>{}),navigator.mediaSession.setActionHandler("pause",()=>{}),navigator.mediaSession.setActionHandler("stop",()=>{}),navigator.mediaSession.setActionHandler("seekbackward",()=>{}),navigator.mediaSession.setActionHandler("seekforward",()=>{}),navigator.mediaSession.setActionHandler("seekto",()=>{}),navigator.mediaSession.setActionHandler("previoustrack",()=>{}),navigator.mediaSession.setActionHandler("nexttrack",()=>{}),"setAudioFocusRequest"in navigator.mediaSession))try{navigator.mediaSession.setAudioFocusRequest({audioFocusRequestType:"transient_may_duck"})}catch(a){}},[]),P=i.useCallback(a=>{const e=new Audio(a);return e.preload="auto",e.volume=.5,e.loop=!1,e.setAttribute("data-timer-audio","true"),e.setAttribute("data-notification-style","true"),e.addEventListener("loadedmetadata",()=>{e.duration>3&&e.addEventListener("timeupdate",()=>{e.currentTime>=3&&(e.pause(),e.currentTime=0)})}),e},[]),$=i.useCallback(a=>{try{const e=new(window.AudioContext||window.webkitAudioContext);fetch(a).then(r=>r.arrayBuffer()).then(r=>e.decodeAudioData(r)).then(r=>{const t=e.createBufferSource();t.buffer=r;const n=e.createGain();n.gain.setValueAtTime(.4,e.currentTime),t.connect(n),n.connect(e.destination),e.state==="suspended"&&e.resume(),t.start(0),t.stop(e.currentTime+Math.min(r.duration,2)),setTimeout(()=>{e.close()},3e3)}).catch(()=>{e.close()})}catch(e){}},[]),j=i.useCallback(()=>{!v.current||Object.keys(v.current).length===0||Object.entries(v.current).forEach(([a,e])=>{e.paused&&e.currentTime>0&&e.currentTime<e.duration&&e.play().catch(()=>{})})},[]);i.useEffect(()=>{const a=()=>{j()},e=()=>{if(!document.hidden&&(j(),l&&A.current&&h.current)){const r=Date.now(),t=Math.max(0,Math.ceil((h.current-r)/1e3));w(t),t===0&&!m&&(p(!0),g(!1),y("end"))}};return window.addEventListener("focus",a),document.addEventListener("visibilitychange",e),()=>{window.removeEventListener("focus",a),document.removeEventListener("visibilitychange",e)}},[j,l,m]);const y=a=>{const e=L[a];try{R.current||(R.current=D()),$(e);const r=v.current[a];if(r){O(),r.currentTime=0,r.volume=.4;const t=r.play();t!==void 0&&t.then(()=>{"mediaSession"in navigator&&(navigator.mediaSession.playbackState="none",setTimeout(()=>{"mediaSession"in navigator&&(navigator.mediaSession.metadata=null)},100))}).catch(n=>{})}}catch(r){}};i.useEffect(()=>(l&&A.current&&h.current?T.current=setInterval(()=>{const a=Date.now(),e=Math.max(0,Math.ceil((h.current-a)/1e3));w(e),V(e),e===0&&!m&&(p(!0),g(!1),y("end"))},100):u===0&&!m&&(p(!0),g(!1),y("end")),()=>{T.current&&clearInterval(T.current)}),[l,u,m]);const V=i.useCallback(a=>{const e=Date.now();if(e-M.current<500)return;if(M.current=e,[7*60,6*60,5*60,3*60,2*60].includes(a)){const t=`minute_${a}`;b.current[t]||(b.current[t]=e,y("minute"))}if(a===4*60){const t="middle_4min";b.current[t]||(b.current[t]=e,y("middle"))}},[]),q=()=>{if(u===0)return;const a=Date.now(),e=u*1e3;A.current=a,h.current=a+e,b.current={},M.current=0,g(!0),p(!1),u===8*60&&y("start")},N=()=>{g(!1),A.current=null,h.current=null,T.current&&clearInterval(T.current)},F=()=>{N(),w(8*60),p(!1),g(!1),b.current={},M.current=0},G=a=>{const e=Math.floor(a/60),r=a%60;return`${e.toString().padStart(2,"0")}:${r.toString().padStart(2,"0")}`};return c.jsx("div",{className:"min-h-screen bg-black flex items-center justify-center p-4",children:c.jsxs("div",{className:"text-center",children:[c.jsx("div",{className:"text-8xl font-light text-gray-300 mb-8 font-mono tracking-wider",children:G(u)}),c.jsxs("div",{className:"flex gap-6 justify-center",children:[!l&&u>0&&!m&&c.jsx("button",{onClick:q,className:"w-16 h-16 bg-gray-700 text-gray-200 rounded-full font-medium hover:bg-gray-600 transition-all duration-200 flex items-center justify-center",title:"Start",children:c.jsx("div",{className:"w-0 h-0 border-l-[16px] border-l-gray-200 border-t-[10px] border-t-transparent border-b-[10px] border-b-transparent ml-1"})}),l&&c.jsxs("button",{onClick:N,className:"w-16 h-16 bg-gray-700 text-gray-200 rounded-full font-medium hover:bg-gray-600 transition-all duration-200 flex items-center justify-center gap-1",title:"Pause",children:[c.jsx("div",{className:"w-1.5 h-6 bg-gray-200 rounded-sm"}),c.jsx("div",{className:"w-1.5 h-6 bg-gray-200 rounded-sm"})]}),c.jsx("button",{onClick:F,className:"w-16 h-16 bg-gray-800 text-gray-200 rounded-full font-medium hover:bg-gray-700 transition-all duration-200 flex items-center justify-center text-3xl",title:"Reset",children:"↺"})]}),c.jsx("div",{className:"mt-6 text-center",children:c.jsxs("span",{className:"inline-block bg-purple-600 text-white text-sm px-4 py-2 rounded-lg font-mono border-2 border-purple-400 shadow-lg",children:["🚀 ",C," • ",d]})})]})})}export{U as TimerPage};
