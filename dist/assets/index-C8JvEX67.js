var m=(e,i,t)=>new Promise((a,o)=>{var s=d=>{try{c(t.next(d))}catch(f){o(f)}},n=d=>{try{c(t.throw(d))}catch(f){o(f)}},c=d=>d.done?a(d.value):Promise.resolve(d.value).then(s,n);c((t=t.apply(e,i)).next())});import{r,j as l}from"./index-B1EWox8y.js";const k={start:"/timer-sounds/start-gong.mp3",middle:"/timer-sounds/middle-gong.mp3",minute:"/timer-sounds/1m-gong.mp3",end:"/timer-sounds/end-gong.mp3"};function $(){const e=r.useRef(),i=r.useRef(),t=r.useRef({}),a=r.useRef(!1),o=()=>m(this,null,function*(){if(!a.current)try{e.current=new(window.AudioContext||window.webkitAudioContext),i.current=e.current.createGain(),i.current.gain.value=.3,i.current.connect(e.current.destination),console.log("🎵 Loading audio files...");for(const[n,c]of Object.entries(k))try{console.log(`🎵 Loading ${n}: ${c}`);const d=yield fetch(c);if(!d.ok){console.warn(`❌ Failed to fetch ${n}: ${d.status}`);continue}const f=yield d.arrayBuffer();t.current[n]=yield e.current.decodeAudioData(f),console.log(`✅ Loaded ${n} audio`)}catch(d){console.error(`❌ Error loading ${n}:`,d)}console.log("🎵 Audio system ready:",Object.keys(t.current)),a.current=!0}catch(n){console.error("❌ Failed to initialize audio system:",n)}}),s=r.useCallback(n=>m(this,null,function*(){if(console.log(`🔔 Attempting to play ${n} gong`),a.current||(yield o()),!e.current||!i.current){console.warn("❌ Audio system not initialized");return}if(!t.current[n]){console.warn(`❌ Audio buffer not loaded for ${n}`);return}e.current.state==="suspended"&&(console.log("🎵 Resuming suspended audio context"),yield e.current.resume());try{const c=e.current.createBufferSource();c.buffer=t.current[n],c.connect(i.current),c.onended=()=>{console.log(`✅ ${n} gong finished playing`)},c.start(0),console.log(`✅ Playing ${n} gong (duration: ${t.current[n].duration.toFixed(2)}s)`),console.log(`📊 ${n} gong buffer duration: ${t.current[n].duration.toFixed(2)}s`)}catch(c){console.error(`❌ Error playing ${n} gong:`,c)}}),[]);return r.useEffect(()=>()=>{e.current&&e.current.close()},[]),s}function j(){r.useEffect(()=>{document.title="Stretch Timer";const e=document.querySelector("link[rel*='icon']"),i=e==null?void 0:e.href;e&&(e.href="/favicons/favicon-timer.svg");const t=document.querySelector("link[rel='manifest']");t==null||t.remove();const a=document.createElement("link");return a.rel="manifest",a.href=`/tools/timer/manifest.webmanifest?v=${Date.now()}`,document.head.appendChild(a),"serviceWorker"in navigator&&navigator.serviceWorker.register("/sw.js").catch(()=>{}),()=>{document.title="Bru Mas Ribera - Frontend & UX Engineer",e&&i&&(e.href=i),a.remove();const o=document.createElement("link");o.rel="manifest",o.href="/site.webmanifest",document.head.appendChild(o)}},[])}function E({active:e}){const[i,t]=r.useState([]),a=r.useRef(0),o=r.useRef();return r.useEffect(()=>{if(!e){t([]),clearInterval(o.current);return}return o.current=setInterval(()=>{const s={id:a.current++,left:`${Math.random()*100}%`,size:Math.random()*2+1,delay:0,duration:Math.random()*5+3,rotate:Math.random()*20-10};console.log("🌟 Generated star:",s),t(n=>[...n.slice(-300),s])},75),()=>clearInterval(o.current)},[e]),console.log("🌟 ShootingStars render - active:",e,"stars count:",i.length),l.jsxs("div",{className:"fixed inset-0 pointer-events-none z-10",children:[i.map(s=>l.jsx("div",{className:"absolute bg-white opacity-90 rounded-full",style:{top:"0px",left:s.left,width:`${s.size*2}px`,height:`${s.size*2}px`,animationDuration:`${s.duration}s`,animationName:"fall",animationFillMode:"forwards",animationTimingFunction:"linear"}},s.id)),l.jsx("style",{children:`
        @keyframes fall {
          0% { transform: translateY(-50px); opacity: 1; }
          100% { transform: translateY(100vh); opacity: 0; }
        }
      `})]})}const R=[420,360,300,240,180,120,60];function M(){const[e,i]=r.useState(480),[t,a]=r.useState(!1),[o,s]=r.useState(!1),[n,c]=r.useState(!1),[d,f]=r.useState(!1),h=r.useRef(0),x=r.useRef(),p=r.useRef({}),y=$();j(),r.useEffect(()=>{if(t)return x.current=setInterval(()=>{const u=Math.max(0,Math.ceil((h.current-Date.now())/1e3));if(i(u),u===0){b("end"),f(!0);return}if(R.includes(u)){const g=`gong_${u}`;p.current[g]||(p.current[g]=Date.now(),c(!0),y(u===240?"middle":"minute").catch(console.error),setTimeout(()=>c(!1),5e3))}},250),()=>clearInterval(x.current)},[t,y]),r.useEffect(()=>{const u=()=>{if(!document.hidden&&t&&h.current){const g=Math.max(0,Math.ceil((h.current-Date.now())/1e3));i(g),g===0&&!o&&b("end")}};return document.addEventListener("visibilitychange",u),()=>document.removeEventListener("visibilitychange",u)},[t,o]);const w=()=>m(this,null,function*(){o||e===0||(h.current=Date.now()+e*1e3,a(!0),s(!1),p.current={},f(!1),y("start"))}),b=u=>m(this,null,function*(){a(!1),u&&(yield y(u),u==="end"&&(s(!0),f(!0))),u!=="end"&&f(!1)}),v=()=>{b(),i(480),s(!1),p.current={}},S=u=>`${String(Math.floor(u/60)).padStart(2,"0")}:${String(u%60).padStart(2,"0")}`;return l.jsxs(l.Fragment,{children:[l.jsx("style",{children:`
          @keyframes timer-pulse-slow {
            0% { background-position: 0% 0%; }
            25% { background-position: 100% 0%; }
            50% { background-position: 100% 100%; }
            75% { background-position: 0% 100%; }
            100% { background-position: 0% 0%; }
          }
          @keyframes timer-pulse-fast {
            0% { background-position: 0% 0%; }
            25% { background-position: 100% 0%; }
            50% { background-position: 100% 100%; }
            75% { background-position: 0% 100%; }
            100% { background-position: 0% 0%; }
          }
          

        `}),l.jsxs("div",{className:`min-h-screen text-white font-mono flex flex-col items-center justify-center overflow-hidden relative ${n?"gong-playing":""}`,"data-timer-page":"true",style:{background:"linear-gradient(135deg, #000000 0%, #0a0a0a 20%, #0a0f1c 40%, #0a0a0a 60%, #0a0f1c 80%, #000000 100%)",backgroundSize:"150% 150%",animation:n?"timer-pulse-fast 8s ease-in-out infinite":"timer-pulse-slow 40s ease-in-out infinite"},children:[d&&l.jsx(E,{active:!0}),l.jsx("div",{className:"text-8xl mb-6 text-gray-300 tracking-wider font-light",children:S(e)}),l.jsxs("div",{className:"flex gap-6",children:[!t&&e>0&&!o&&l.jsx("button",{onClick:w,title:"Start",className:"w-16 h-16 bg-gray-700 hover:bg-gray-600 rounded-full flex items-center justify-center",children:l.jsx("div",{className:"w-0 h-0 border-l-[16px] border-t-[10px] border-b-[10px] border-transparent border-l-gray-200 ml-1"})}),t&&l.jsxs("button",{onClick:()=>b(),title:"Pause",className:"w-16 h-16 bg-gray-700 hover:bg-gray-600 rounded-full flex items-center justify-center gap-1",children:[l.jsx("div",{className:"w-1.5 h-6 bg-gray-200"}),l.jsx("div",{className:"w-1.5 h-6 bg-gray-200"})]}),l.jsx("button",{onClick:v,title:"Reset",className:"w-16 h-16 bg-gray-800 hover:bg-gray-700 rounded-full flex items-center justify-center text-3xl",children:"↺"})]})]})]})}function A(){const[e,i]=r.useState("v1.1.9"),[t,a]=r.useState("28 Thursday August 16:59");return r.useEffect(()=>{fetch(`/VERSION.json?v=${Date.now()}`).then(o=>o.json()).then(o=>{const s=new Date(o.timestamp+" UTC");i(`v${o.version}`),a(`${s.getDate()} ${s.toLocaleDateString("en-US",{weekday:"long"})} ${s.toLocaleDateString("en-US",{month:"long"})} ${s.toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit"})}`)}).catch(()=>{})},[]),{version:e,date:t}}export{M as TimerPage,$ as useAudio,j as usePWA,A as useVersion};
